---
title: "Title"
date: '2022-10-26'
output:
  pdf_document:
    latex_engine: xelatex
  word_document: default
header-includes: \usepackage{float} \floatplacement{figure}{H} \usepackage{caption}
  \renewcommand{\caption}{Figure}
bibliography: library.bib
csl: journalofecol.csl
editor_options:
  markdown:
    wrap: sentence
---

# Abstract

1.  The stability of ecological communities over time, often measured as its aggregated abundance or biomass, is mainly influenced by species richness and the asynchrony of the species fluctuations.
    However, the relation with the stability of ecosystem functioning provided by this community is less explored, specially for functions involving several trophic levels such as plant pollination.
    Understanding the mechanisms driving community stability and whether this stability should be related to the stability of ecosystem functions provided is important for predicting the resilience of communities to changes in biodiversity.

2.  Using a 5-year dataset across 13 Mediterranean shrub patches, we assessed the effect of the richness and asynchrony of pollinators as drivers of the stability of plant's visitation rate and plants reproductive success.
    In addition, we analyzed whether the effects of species richness and visitation rate on plant reproduction success were consistent among years.

3.  The stability of plant's visitation rate is driven by the asynchrony of pollinator species abundances but not by the pollinator richness.
    In contrast, the stability of the plant reproductive success is not related to the stability of the visitation rate.
    A year by year analysis revels that plants are unlikely to be limited by pollinator abundances except in specific years with [extreme low levels of pollinator activity](esto es así Molaria).

4.  CONCLUSION

# Introduction

Global environmental changes and the consequent loss of biodiversity have highlighted the need for better understanding the role of biodiversity in ecosystem function [@Hooper2005; @Lefcheck2015; @Oliver2015; @Hong2022].
We have experimental and observational evidence that biodiversity enhances aggregated community-level properties, such as total biomass [@Cardinale2006; @Cardinale2012; @Tilman2014], but the role of biodiversity for the stability of ecosystem functioning is less explored (but see @Griffin2009; @Grman2010), specially for functions involving several trophic levels such as plant pollination [@Ebeling2008; @Winfree2009a; @Garibaldi2011; @Lazaro2022].
Globally, it is estimated that at least 78% of wild plants depend to some extent on pollination by animals [@Ollerton2011].
Understanding the mechanisms driving pollinator community stability and how this relates to the stability of ecosystem functions and services delivered (i.e. pollination) is important for predicting changes in both community structure and ecosystem function.

Temporal stability is defined as the capacity of an ecosystem to dampen environmental perturbations over time while retaining ecological functions of interest [@Ives2007; @Pimm1984].
Among the main driving forces of community stability are the diversity of species present and the asynchrony on the species abundance fluctuations.
A higher number of species might stabilize community level functions by increasing the range of species level potential responses to environmental changes (i.e. the portfolio effect) [@McCann2000; @Tilman2006; @Hector2010; @Xu2021], although non-significant relationships between diversity and stability have also been observed [@Hooper2005; @VanderPlas2019].
However, a more direct stabilizing mechanisms the degree of asynchrony in species abundance fluctuations.
In this sense, higher levels of asynchrony stabilize the community [@Ruijven2007; @Bluthgen2016; @Craven2018].
In fact, stability is often more strongly associated with the degree of asynchrony across species than with species richness [@Bluthgen2016; @Valencia2020].
While community temporal stability should be related to the stability of ecosystem functions and services provided by such community, there is limited evidence linking both processes on multitrophic systems.
[comment](aqui hecho a faltar la alternativa, solo la asyncronia entre las especies más abundantes es lo que cuenta)

Since the reproductive success of most plant species highly depends on pollination by animals [@Ollerton2011], the stability of pollinator communities may increase the stability of plant reproductive success.
A greater diversity of pollinators has been shown to increase plant reproductive success as a result of complementary in service provision arising from variation of pollinator effectiveness across space and time [@Hoehn2008; @Frund2010; @Albrecht2012; @Bluthgen2011; @Frund2013].
For example, pollinator species may exhibit different ranges of temporal activity [@Pisanty2016; @Rader2016] and consequently may provide pollination services at different times of the day or of the season.
While some studies report that sites with higher visitation rates show higher plant reproductive outputs [@Garibaldi2013; @Kaiser-Bunbury2017], other studies do not find such relationship [@Hegland2012; @Lundgren2013].
Interestingly, studies looking at pollen limitation show that sites with higher visitation rates show no pollen limitation, indicating than above a certain threshold, changes in visitation rates are no longer relevant (Fig. 1; Cosacov et al., 2008; Gómez et al., 2010; Williams & Winfree, 2013).
However, the occurrence and magnitude of pollen limitation can vary among years for individual populations (Burd 1994, Ashman et al. 2004), primarily because of variation in pollinator service (Aizen and Harder 2007).

```{r,echo=FALSE, warning=FALSE,message=FALSE, fig.height = 8,fig.width=10,out.width="60%",fig.align='center'}
library(ggplot2)
library(patchwork)


#First dataset RED
s1 <- seq(from=0, to=100, by=0.5)
l1 = log(s1, base = 6)
d1 = data.frame(l1, s1)


#Second dataset BLUE
s2 <- seq(from=0, to=100, by=0.5)
l2 = log(s2, base = 8)
d2 = data.frame(l2, s2)

#Third dataset GREEN
s3 <- seq(from=0, to=100, by=0.5)
l3 = log(s3, base = 12)
d3 = data.frame(l3, s3)



to=ggplot(d1, aes(s1, l1)) +
  geom_line(color = "#e41a1c", linewidth=1.3) +
  geom_line(data =  d2, aes(s2,l2), color = "#377eb8",linewidth=1.3) +
  geom_line(data =  d3, aes(s3,l3), color = "#4daf4a",linewidth=1.3) +
  ylab("Reproductive success")+
  labs(x = "") +
  theme_classic()+
  theme(axis.text.y=element_blank(),
        axis.ticks.y=element_blank())+
  scale_x_continuous(breaks=seq(from= 0, to= 100, by = 20), labels=c("V1","V2","V3", "V4","V5","V6"))+
  theme(text = element_text(size=18,face="bold"))+
  theme(axis.ticks.x=element_blank())+
  annotate("rect", xmin = c(0, 60), xmax = c(20,80), ymin = c(0.4, 1.35), 
           ymax = c(1.75, 2.7), linetype = 1, fill="gray88", alpha=0.3, colour = "black") +
  annotate("text", x = c(98, 98,98), y = c(2.67, 2.31,1.95), label = c("R3", "R2", "R1"), size=5)+
  annotate("text", x = c(1.25, 61.3), y = c(1.62,2.58), label = c("A", "B"), size=6)+
  theme(axis.line.x = element_line(arrow = arrow()))+
  theme(axis.line.y = element_line(arrow = arrow()))



##################################
x <- seq(0, 41, by = 0.1)
y1 <- sin(x)
y1.2 <- cos(x+4.3)

da1 <- data.frame( x, y1)
da1.2 <- data.frame( x, y1.2)

R_1=ggplot(da1, aes(x, y1))+
  geom_line( size=1) +
  geom_line(data =  da1.2, aes(x, y1.2), color = "#e41a1c",size=1)+
  theme_classic() +
  xlab("Time") +
  theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank()) + 
  scale_y_continuous(breaks=seq(from= -1, to= 1, by = 2), labels=c("R1","R3"))+
  theme(text = element_text(size=15, face="bold"))+
  theme(axis.title.y = element_blank()) +
  annotate("text", x = 44, y = 0.4, label = "Rep", size=4,color="#e41a1c")+
  annotate("text", x = 43, y = 0, label = "R", size=4)+ 
  theme(aspect.ratio=0.5)



###################################

x2 <- seq(0, 41, by = 0.1)
y2 <- sin(x2)
y3 = sin(x2/2.5)

da2 <- data.frame(x2, y2)
da2.1 = data.frame(x2,y3)

v_1=ggplot(da2, aes(x2, y2))+
  geom_line( size=1) +
  geom_line(data =  da2.1, aes(x2,y3), color = "#e41a1c",size=1)+
  theme_classic() +
  xlab("Time")+
  theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+ 
  scale_y_continuous(breaks=seq(from= -1, to= 1, by = 2), labels=c("V1","V2"))+
  theme(text = element_text(size=15, face="bold"))+
  theme(axis.title.y = element_blank())+
  annotate("text", x = 44, y = -0.5, label = "Rep", size=4, color="#e41a1c")+
  annotate("text", x = 42.5, y = 0, label = "V", size=4) + 
  theme(aspect.ratio=0.5)


po1=v_1/R_1


######################
x3 <- seq(0, 57, by = 0.1)
y3 <- sin(x3)
y3.1 <- cos(x3+4.3)

da3 <- data.frame(x3, y3)
da3.1 <- data.frame(x3, y3.1)

v_2=ggplot(da3, aes(x3, y3))+
  geom_line( size=1) +
  geom_line(data =  da3.1, aes(x3,y3.1), color = "#e41a1c",size=1)+
  theme_classic() +
  xlab("Time") +
  theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank()) + 
  scale_y_continuous(breaks=seq(from= -1, to= 1, by = 2), labels=c("V4","V5"))+
  theme(text = element_text(size=15, face="bold"))+
  theme(axis.title.y = element_blank()) +
  annotate("text", x = 61, y = 0, label = "Rep", size=4,color="#e41a1c")+
  annotate("text", x = 59, y = 0.3, label = "V", size=4)+ 
  theme(aspect.ratio=0.5)




########################################
x4 <- seq(0, 57, by = 0.1)
y4 <- sin(x4)
y5 = sin(x4/2.5)


da4 <- data.frame(x4, y4)
da5 = data.frame(x4,y5)

R_2=ggplot(da4, aes(x4, y4))+
  geom_line( size=1) +
  geom_line(data =  da5, aes(x4,y5), color = "#e41a1c",size=1)+
  theme_classic() +
  xlab("Time")+
  theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank())+ 
  scale_y_continuous(breaks=seq(from= -1, to= 1, by = 2), labels=c("R1","R3"))+
  theme(text = element_text(size=15, face="bold"))+
  theme(axis.title.y = element_blank())+
  annotate("text", x = 61, y = -0.6, label = "Rep", size=4, color="#e41a1c")+
  annotate("text", x = 59, y = 0.4, label = "R", size=4)+ 
  theme(aspect.ratio=0.5)


po2=v_2/R_2


to/ (po1 |po2)
```



Here, we use a 5-year dataset collected across 13 Mediterranean woodland patches to study the role of pollinator richness and asynchrony as drivers of stability of its visitation rates to 5 plant species.
Further, we evaluate whether more stable pollinator communities foster a more stable plant reproductive success along years, measuring both the stability of fruit and seed set.
We expect that the stability of visitation rates will increase with higher richness and asynchrony of pollinators.
In addition, a greater stability of plant reproductive success is expected with higher stability of visitation rate.
However, given the lack of a clear relationship between pollinator and plant reproductive output stability, we further analyzed the variability on the yearly effect of pollinator richness and visitation rate on the reproductive success of the plants.

# Material and method

Our study was conducted in the southwest of the Iberian Peninsula (Huelva and Sevilla - Spain).
We selected 13 sites in Mediterranean shrub ecosystems that ranged from sites with little to no disturbances to more modified ones with crops and urban areas nearby.
These sites are similar in the plant community composition and the most abundant plant species are known to be attractive to flower visitors and to depend on pollinators to maximize its reproduction (e.g. dominated by *Cistus crispus*, *Cistus ladanifer*, *Cistus salviifolius*, *Halimium halimifolium*, and *Lavandula pedunculata*).
Each site was surveyed at least 7 times per year during the flowering season from 2015 to 2019 (from March to June).
Within each site, we selected 3-4 individuals belonging to 3-9 plant species (mean ± standard error: 5.92 ± 0.54 plant species per site).
We performed focal observations where all the floral visitors (from now on referred to as pollinators) that contacted with their flowers were registered.
Only pollinators that could not be identified in the field were captured, stored, and identified to species level in the laboratory.
For each plant individual, we counted the total number of flowers observed in each survey and at the end of the season, we recorded the number of fruits developed and the number of seeds per fruit in a subsample of [3 fruits.](en algunos casos solo habia contado para dos frutos pero la mayoria son 3)
Focal observations had a duration of five minutes per individual in 2015-2016 and three minutes from 2017 to 2019.
Hence, for each plant individual, the sampling effort was standardized in number of visits per flower per minute.
To that end, we divided the total visits observed by the number of flowers observed and by the total observation time (time observation multiplied by number of survey per year).
Pollinator richness is calculated as the number of different species observed, fruit set as the proportion of fruits developed, and the seed set as the mean number of seeds per fruit for each plant individual sampled per site.

## Stability

We analyze five plant species (*Cistus crispus*, *Cistus ladanifer*, *Cistus salviifolius*, *Halimium halimifolium*, and *Lavandula pedunculata*) that were recorded in at least 5 sites in a minimum of two years per site [(show mean sites / years per plant).]()
The stability of pollinator visitation rates was quantified as the inverse of the coefficient of variation (mean/SD) for each plant species in each plot following Tilman, 1999.
To examine the role of richness and synchrony of pollinator species as drivers of stability of visitation rate, we calculate the richness as the total number of pollinator species that visit each plant species in each plot.
The synchrony index for each plant species in the plot was calculated following Loreau and de Mazancourt (2008), as:
$$
\begingroup\Large
\phi =\frac{\sigma_{x_T}^2}{(\sum_{i=1}^S\sigma_{x_i})^2}
\endgroup
$$ where ${\sigma_{x_T}^2}$ is the variance of the community abundance of each plot and ${\sigma_{x_i}}$ is the standard deviation of species i abundance in a community with S species.
This synchrony measurement varies from zero, when fluctuations are perfectly asynchronous, to one, when fluctuations are perfectly synchronous [@Loreau2008].
Finally, we express asynchrony as $1-\phi$.
We also calculated the stability of fruit proportion and of the seed number for each plant species in each plot using the same index.

## Statistical analysis

Linear mixed models were used to evaluate the relationships between 1) stability of visitation rate and asynchrony of pollinator, 2) stability of visitation rate and pollinator richness, and 3) asynchrony and pollinator richness.
In all cases, site and plant species were included as random factor.
For a deeper understanding, we also analyzed the response for each plant species separately.
[a bit of why three models could help the reader]

To study whether the stability of the visitation rate influenced in the stability of the plant reproductive success, we run linear mixed models using as response variables the stability of fruit proportion or the stability of seed number and as explanatory variable the visitation rate stability.
Site and plant species were included as factor random.

To detect whether the effect of pollinator richness and visitation rate is different across the years, we use all 12 plant species sampled.
We analyzed the interactive effect between richness and year, and between visitation rate and year on fruit proportion using binomial generalized linear mixed model, and on the number of seeds employing linear mixed model. *P* values were obtained using the type III Anova (package: car)
The number of seeds per fruit was centered and scaled per plant species to allow meaningful comparisons across species.
For all models, we included plant species identity nested within site and site as random effects because of multiple individuals of the same plant species are measured at each site.

All the analyses of this study were conducted in R software (v. 4.0.2; R Core Team, 2022) and the lme4 (Bates et al., 2015) and ggplot2 (Wickham, 2016) packages.
DHARMa package was employed for checking all models (Harting 2017)

# Results

## Stability of visitation rate and its drivers: richness and asynchrony

Stability of visitation rates ranged from 0.64 to 9.24 (mean ± SE: 1.928 ± 0.232), whereas pollinator richness ranged from 2 to 20 species (8.128 ± 0.686) and the pollinator asynchrony varied from 0 to 0.998 (0.754 ± 0.032).
There is a strong positive relationship between stability of visitation rates and asynchrony of pollinator species abundances with greater visitation rate stability when pollinator asynchrony increases (Estimate ± standard error: 2.903 ± 1.134) (Fig 2A), whereas stability of visitation rate was not influenced by the pollinator richness (-0.001 ± 0.063) (Fig 2B).
We also found a positive relationship between asynchrony and pollinator richness (0.020 ± 0.005) (Fig 2C).
However, note that despite one data point has a high leverage on the stability analysis
(*C.crispus*), when we removed this point the tendencies remain unchanged.

When we analysed each plant species separately, we observed positive relationship between asynchrony of pollinators and visitation rate for *C. crispus*, *H. halimifoliun* and *L. pedunculata*, weak relationship for *C. salviifolious* and a weak negative relationship for *C.ladanifer*.
For the relationship with pollinator richness, *C. crispus*, *C. ladanifer* and *C. salviifolius* showed a negative relationships wile *H. halimifolium* and *L. pedunculata* showed positive relationships, explaining the overall lack of relationship across all five plants (Supplementary material-Fig 1).

```{r, echo=FALSE, warning=FALSE,message=FALSE,fig.height = 8,fig.width=20, out.width="100%",fig.align='center', fig.cap =" 2.Relationships between stability of visitation rate (calculated as the inverse of the coefficient of variation) and asynchorny of pollinators (Loreau and de Mazancourt’s index) (A), stability of visitation rate and pollinator richness (B), and asynchorny of pollinators and richness (C).Dots represent the different plant species incluided in the analysis.Significant models are representing with solid line."}

library(tidyverse)
library(lme4)
library(effects)
library(patchwork)


# staility of visitation rate and richness and asynchrony
# plant species present at least in five sites
# C.crispu, C. ladanifer, C. salviifolius, H.halimifolium and L. pedunculata

# stability data 
data_plant<- read.csv("../Data/Stability.csv")
data_plant<-data_plant[,-1]


# eliminar plant species 
sp_out2=data_plant %>%
  group_by(Plant_gen_sp) %>%
  summarise(Unique_Id = n_distinct(Site_ID)) %>%
  filter(Unique_Id <= 4) %>%
  select(Plant_gen_sp) %>% pull(Plant_gen_sp)

#Data with species in at least 5 sites
data_plant = data_plant %>% filter(!Plant_gen_sp %in% sp_out2)


data_plant=data_plant %>%
  filter(!Plant_gen_sp=="Salvia rosmarinus") %>%
  filter(!Plant_gen_sp=="Halimium calycinum")%>%
  filter(!Plant_gen_sp=="Lavandula stoechas")



## Replace Inf and -Inf with NA
data_plant[is.na(data_plant) | data_plant == "Inf"] <- NA 
data_plant[is.na(data_plant) | data_plant == "-Inf"] <- NA 



# We can express asynchrony as 1 - φ, 
#where φ is Loreau and de Mazancourt’s (2008)
data_plant$asyn_LM= 1-data_plant$syncLM


#model 
mod1_sta= lmer (cv_1_visitation ~ asyn_LM + (1|Site_ID) + (1|Plant_gen_sp), data = data_plant)



#getting effects for asynchrony
effe_mod_sta <-data.frame( effect("asyn_LM", mod1_sta, se = TRUE))


#plot model of asynchrony
p1=ggplot(effe_mod_sta, aes(asyn_LM, fit)) + geom_line(size=1)+
  geom_ribbon(aes(ymin = lower, ymax = upper),alpha=0.2)+
  scale_y_continuous(limits = c(-2.5, 9.5))+labs(color='Plant species')+
  geom_point(data = data_plant, aes(x =  asyn_LM, y = cv_1_visitation, color=Plant_gen_sp), alpha=0.7,size=6)+
  scale_colour_brewer(palette = "Set1")+
   theme_bw ()+
  labs(x = "Asynchrony of pollinator",y="Stability of visitation rate")+
  guides(colour=guide_legend(nrow=2,byrow=TRUE))+ theme(legend.text = element_text(face="italic"))



#model richness
mod1.2_sta= lmer (cv_1_visitation ~ S_total + (1|Site_ID) + (1|Plant_gen_sp), data = data_plant)


#getting effects for richness
effe2_mod_sta <-data.frame( effect("S_total", mod1.2_sta, se = TRUE))



#plot model of richness
p2=ggplot(effe2_mod_sta, aes(S_total, fit)) + geom_line(size=1,linetype = "dashed")+
  geom_ribbon(aes(ymin = lower, ymax = upper), alpha=0.1)+
  scale_y_continuous(limits = c(-2.5, 9.5))+  labs(color='Plant species')+
  geom_point(data = data_plant, aes(x =  S_total, y = cv_1_visitation, color=Plant_gen_sp), alpha=0.7,size=6)+
  scale_colour_brewer(palette = "Set1")+
  theme_bw ()+
  labs(x = "Richness of pollinator",y="Stability of visitation rate") +
  guides(colour=guide_legend(nrow=2,byrow=TRUE))+ theme(legend.text = element_text(face="italic"))
  

# relationship between richness and asynchrony
mod_rich_asyn= lmer (asyn_LM ~ S_total +  (1|Site_ID) + (1|Plant_gen_sp), weights = asyn_LM, data = data_plant)

#getting effects for richness
effe_rich_mod_sta <-data.frame( effect("S_total", mod_rich_asyn, se = TRUE))
#plot model 
p1.2=ggplot(effe_rich_mod_sta, aes(S_total, fit)) + geom_line(size=1)+
  geom_ribbon(aes(ymin = lower, ymax = upper), alpha=0.2)+
  labs(color='Plant species')+
  geom_point(data = data_plant, aes(x =  S_total, y = asyn_LM, color=Plant_gen_sp), alpha=0.7,size=6)+
  scale_colour_brewer(palette = "Set1")+
  theme_bw ()+
  labs(x = "Richness of pollinator",y="Asynchrony of pollinator")+
  guides(colour=guide_legend(nrow=2,byrow=TRUE))+ theme(legend.text = element_text(face="italic"))
  



#join plots
p_cv_visit=p1+p2+ p1.2+
  plot_annotation(tag_levels = "A")& 
  theme(plot.tag.position = c(0, 1),
        plot.tag = element_text(hjust = -0.1,vjust=0.5, size=25))& 
  theme(legend.position = "bottom",legend.background = element_blank(),legend.box.background = element_rect(colour = "black"))&theme(text = element_text(size=25))
p_cv_visit+ plot_layout(guides = "collect")

```

## Stability of visitation rate and stability of the plant reproductive success

Stability of fruit proportion varied from 2.62 to 120.66 (mean ± SE: 19.806 ± 3.615), whereas the stability of seed number ranged 1.28 to 55.86 (7.018 ± 1.441).
When we analyzed whether the stability of the pollinator's visitation rate affected the stability of the plant reproductive success, we did not find a clear relationship when analyzing the fruit proportion (Estimate: -1.547; std. error: 2.611) (Fig 3A).
However, contrary to expected, the stability of seed number did show a negative relationship with the stability of pollinator's visitation rate (Estimate: -1.887; std. error: 0.959) (Fig 3B).Although this tendency is influenced by a high value in the stability of seed number of *H. halimifolium* since when we removed this point the relationship disappears. 

```{r,echo=FALSE, warning=FALSE,message=FALSE, fig.height = 10,fig.width=20,out.width="80%",fig.align='center', fig.cap = " 3. Relationship between stability of plant reproductive succes: fruit propotion (A) and seed number (B) and the stability of visitation rate. Dots represent the different plant species incluided in the analysis.Significant models are representing with solid line."}

#model fruit stability ~ visitation rate stability
mod2_sta= lmer(cv_1_fruit ~ cv_1_visitation + (1|Plant_gen_sp)+(1|Site_ID), data = data_plant)

#getting effects 
effe3_mod_sta <-data.frame( effect("cv_1_visitation", mod2_sta, se = TRUE))


#plot model 
p_mod2=ggplot(effe3_mod_sta, aes(cv_1_visitation, fit)) + geom_line(size=1,linetype = "dashed")+
  geom_ribbon(aes(ymin = lower, ymax = upper), alpha=0.1)+
  geom_point(data = data_plant, aes(x =  cv_1_visitation, y = cv_1_fruit, color=Plant_gen_sp),alpha=0.7, size=7)+
  labs(color='Plant species')+
  scale_colour_brewer(palette = "Set1")+
  labs(y = "Stability of fruit proportion",x="Stability of visitation rate")+
  theme_bw ()+
  guides(colour=guide_legend(nrow=2,byrow=TRUE))+ theme(legend.text = element_text(face="italic"))





# model seed stability ~ visitation rate stability
mod3_sta= lmer(cv_1_seed ~ cv_1_visitation + (1|Plant_gen_sp)+(1|Site_ID), data = data_plant)


#getting effects 
effe4_mod_sta <-data.frame( effect("cv_1_visitation", mod3_sta, se = TRUE))


#plot model 
p_mod3=ggplot(effe4_mod_sta, aes(cv_1_visitation, fit)) + geom_line(size=1)+
  geom_ribbon(aes(ymin = lower, ymax = upper), alpha=0.2)+
  labs(color='Plant species')+
  geom_point(data = data_plant, aes(x =  cv_1_visitation, y = cv_1_seed, color=Plant_gen_sp), alpha=0.7,size=7)+
  scale_colour_brewer(palette = "Set1")+
  labs(y = "Stability of seed number",x="Stability of visitation rate")+
  theme_bw ()+
  guides(colour=guide_legend(nrow=2,byrow=TRUE))+ theme(legend.text = element_text(face="italic"))



#join plots
p_plant=p_mod2+p_mod3+ 
  plot_annotation(tag_levels = "A")& 
  theme(plot.tag.position = c(0, 1),
        plot.tag = element_text(hjust = -0.8, vjust = 0.5,size=30))& 
  theme(legend.position = "bottom",legend.background = element_blank(),legend.box.background = element_rect(colour = "black"))&theme(text = element_text(size=30))
p_plant+ plot_layout(guides = "collect")

```

## Effect of pollinators across years on plant reproductive success

When we analysed whether the effect of pollinator richness and visitation rate on fruit proportion is different across the years, we found that both variables showed a significant interaction with year (richness interaction with year: $\chi 2$ =  28.976, df = 4, *p* = \<0.0001; visitation rate interaction with year: $\chi 2$ =  40.691, df = 4, *p* = \<0.0001)
Although we observed a general saturation of the proportion of fruits developed with most species consistently over 80% of fruit set, in years like 2017 we showed that a greater richness and visitation rate increased the fruit proportion.
We also observed a positive relationship between richness and fruit proportion in 2019.
However in 2018, the relationship between richness and fruit proportion was negative (Fig 3).
[esto requiere un poco más de story telling.
Por ejemplo, estos años son años altos o bajos en polinizadores?]

For the seed number, we not found the interaction effect to pollinator richness (p = 0.628), however we found a marginal significant interaction between visitation rate and year (p = 0.058).
We observed that a higher visitation rate increased the seed number in 2019 (Supplementary material-Fig 2).
[idem, p-values ahora?]

```{r,echo=FALSE, warning=FALSE,message=FALSE,fig.height =13,fig.width=30,out.width="100%", fig.align='center',fig.cap=" 3. Interaction effect between richness and year (top row), and visitation rate and year (bottom row) on fruit proportion. For the visualization purpose, we omit in the visitation rate (x-axis) the values outside of the 95\\%."}

Pollinator_Plant<- read.csv("../Data/Pollinator_Plant.csv") #400 observaciones
Pollinator_Plant<-Pollinator_Plant[,-1]
Pollinator_Plant$Year= as.factor(Pollinator_Plant$Year)
Pollinator_Plant$Site_ID= as.factor(Pollinator_Plant$Site_ID)
Pollinator_Plant$Plant_gen_sp= as.factor(Pollinator_Plant$Plant_gen_sp)


# species out
#plant species that for each year occur only at one site
spp_out <- Pollinator_Plant %>%
  group_by(Plant_gen_sp, Year) %>%
  summarise(Unique_Id = n_distinct(Site_ID)) %>%
  filter(Unique_Id == 1) %>%
  select(Plant_gen_sp, Year)


Pollinator_Plant= anti_join(Pollinator_Plant, spp_out)



# model 1
mod1_to= glmer(cbind(fruit_formado, Fruit_No) ~ S_total * Year + (1|Site_ID/Plant_gen_sp),family=binomial,data=Pollinator_Plant)

#getting effects for the two variables
ee_mod1 <- as.data.frame(Effect(c("S_total","Year"),mod = mod1_to))

p1=ggplot(ee_mod1, aes(S_total,fit))+
  geom_line(size=0.8)+
  geom_ribbon(aes(ymin = lower, ymax = upper), alpha = .2)+
  geom_point(data= Pollinator_Plant, aes(x = S_total , y = fruit_proportion),shape=21, fill="grey", size=6)+
  labs(x = "Pollinator richness",y="Fruit proportion")+
  facet_wrap(~Year, nrow = 1) + 
  theme_bw ()+
  theme(legend.position = "none")



# model 2
mod2_to= glmer(cbind(fruit_formado, Fruit_No) ~ visitatio_rate * Year + (1|Site_ID/Plant_gen_sp),family=binomial,data=Pollinator_Plant)

#getting effects for the two variables
ee_mod2 <- as.data.frame(Effect(c("visitatio_rate","Year"),mod = mod2_to))

p2=ggplot(ee_mod2, aes(visitatio_rate,fit))+
  geom_line(size=0.8)+  
  geom_ribbon(aes(ymin = lower, ymax = upper), alpha = .2)+
  geom_point(data= Pollinator_Plant, aes(x =visitatio_rate , y = fruit_proportion),shape=21, fill="grey", size=6)+
  labs(x = "Visitation rate",y="Fruit proportion")+
  facet_wrap(~Year, nrow = 1) + 
  coord_cartesian(xlim=c(0, quantile(Pollinator_Plant$visitatio_rate,0.95)))+
  theme_bw ()+
  theme(legend.position = "none")


p1/p2&theme(text = element_text(size=35))


```

# Discussion

We show that pollinator's visitation rate stability increase with higher asynchrony of pollinators species abundances and that greater species richness only increase stability of visitation rate indirectly, via enhanced species asynchrony.
However, contrary to expectations, we found no relationship between the stability of visitation rates and the stability of plant reproductive success.
This is because in our study system, plant reproduction is not pollinator limited in most years, with most plants reaching maximum reproductive success even in the sites with lower pollinator abundances.
However, this do not imply that pollinators are not important or that are always in enough numbers to disregard them, because for specific years [seria ideal decir quales... los que tienen poco polinizador?
Los secos, quizas?]
the relationship between pollinator activity and plant's reproductive output kicks in as important.
When and where pollinators are limiting is the key question then.
[esta frase a lo mejor puede ser una conclusing sentence del paper, por ahora la dejo aquí]

While drivers of temporal stability have been well study in plant communities [@Ruijven2007; @Gross2014; @Craven2018; @Leps2018; @Sasaki2019; @Valencia2020; @Kigel2021], relatively few studies have evaluated how this same drivers can affect community stability in mobile organisms such as pollinators [@Ebeling2008; @Senapathi2021; @Lazaro2022].
A first clear outcome of our analysis is that asynchrony of species abundances is a key driver of visitation rate stability.
This stability--asynchrony relationship has been found by different theoretical and empirical studies (de Mazancourt et al., 2013; Blüthgen et al., 2016; Lepš et al., 2018; Sasaki et al., 2019; Valencia et al, 2020, Kigel et al 2021).
For example, Lázaro et al.(2022) also found that plants or pollinators?
temporal or spatial?
asynchrony is an important driver of stability for for plants, pollinators and their interactions.
[The fact that species asynchrony increases the temporal stability of the visitation rate is likely because a decrease in the abundance of one pollinator species is compensated by an increase of the abundance of another.](escribir%20mejor%20la%20frase)
[mirate los appaers de Winfree sobre esto que lo explica muy bien y explica mecanismos] On the other hand, species richness is considered one of the strongest drivers of community stability [in plants?]
(Tilman et al., 2006; de Mazancourt et al., 2013; Hallett et al., 2014), although Valencia et al.(2020) have reported that this relation is not nearly as strong [where?].
Pollinator studies have observed a positive relationship between richness and stability of what?
in crops??
(Ebeling et al 2008; Senapathi et al 2021), however, our results show that richness was positively associated with asynchrony, which might positively affect the stability of visitation rate, but indirectly.
[This most likely reflects niche variation among species that affect their relative performance over time in a temporally variable environment (Yachi & Loreau,1999; Gross et al., 2014; Craven et al 2018).](??)

Despite the stability is crucial to the sustainability of ecosystem functions, relatively few studies have evaluated the stability of the pollinator visits frequency on pollination services, and those who did used agricultural systems [right?]
(Garibaldi et al. 2011, Lázaro and Alomar 2019, Hünicken et al 2021, Bishop et al 2022).The majority of these studies were focused on crops, however, to our knowledge, how the stability of pollinator community affect to the reproductive success of the wild plant community remaining largely unknown.
In pollinator-dependent crops have been observed a greater yield stability with the pollinator diversity and the stability of visitation rate (Garibaldi et al. 2011, Hünicken et al 2021), however in our study system (wild plants), we did not find this relationship or even observed a negative relationship between seed number stability and visitation rate stability.

\newpage

# Supplementary material

```{r, echo=FALSE, warning=FALSE,message=FALSE,fig.height = 13,fig.width=30,out.width="100%", fig.align='center',fig.cap=" 1. Changes in the stability of visitation rate with the asynchrony (top row) and richness (botton row) are shown for each plant species"}
# model plot (cv_1_visitation~S_total+asynchrony)


# plot for richness
plot_stabi_plant <- data_plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(mod = list(lm(cv_1_visitation~S_total,data))) %>%
  mutate(mod1 = list(ggeffects::ggpredict(mod, terms = "S_total"))) %>%
  mutate(plots = list(ggplot(mod1, aes(x, predicted)) + geom_line(size=1) +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), linetype = 3, alpha=0.2, colour = "black")))

#Cistus crispus
p1=plot_stabi_plant$plots[[1]] + geom_point(data =data_plant %>% filter(Plant_gen_sp == "Cistus crispus"), 
  aes(x =  S_total, y = cv_1_visitation),color="#e41a1c", alpha=0.7,size=7)+ 
  labs(x = "",y="Stability of visitation rate")+scale_x_continuous(limits = c(9, 16))+
  scale_y_continuous(limits = c(-5,9.5))+
  theme_bw ()


#Cistus ladanifer
p2=plot_stabi_plant$plots[[2]] + geom_point(data = data_plant %>% filter(Plant_gen_sp == "Cistus ladanifer"), 
  aes(x =  S_total, y = cv_1_visitation),color="#377eb8",alpha=0.7, size=7)+ 
  labs(x = "",y=NULL)+scale_x_continuous(limits = c(3, 16))+ 
  scale_y_continuous(limits = c(-1.55,4))+
  theme_bw()

#Cistus salviifolius
p3=plot_stabi_plant$plots[[3]] + geom_point(data = data_plant %>% filter(Plant_gen_sp == "Cistus salviifolius"), 
  aes(x =  S_total, y = cv_1_visitation),color= "#4daf4a",alpha=0.7, size=7)+ 
  labs(x = "Richness",y=NULL)+scale_x_continuous(limits = c(3, 20))+  
  scale_y_continuous(limits = c(-3,6))+
  theme_bw()


#Halimium halimifolium
p4=plot_stabi_plant$plots[[4]] + geom_point(data = data_plant %>% filter(Plant_gen_sp == "Halimium halimifolium"), 
  aes(x =  S_total, y = cv_1_visitation), color= "#984ea3",alpha=0.7, size=7)+   labs(x = "",y=NULL)+ scale_x_continuous(limits = c(4, 14))+ 
  scale_y_continuous(limits = c(-0.7,3))+
  theme_bw()


#Lavandula pedunculata
p5=plot_stabi_plant$plots[[5]] + geom_point(data = data_plant %>% filter(Plant_gen_sp == "Lavandula pedunculata"), 
  aes(x =  S_total, y = cv_1_visitation),color="#ff7f00",alpha=0.7, size=7)+ 
  labs(x = "",y=NULL)+  
  scale_y_continuous(limits = c(-0.7,4.7))+
  theme_bw()




# model plot for asynchrony
plot_stabi_plant_2 <- data_plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(mod = list(lm(cv_1_visitation~asyn_LM,data))) %>%
  mutate(mod1 = list(ggeffects::ggpredict(mod, terms = "asyn_LM"))) %>%
  mutate(plots = list(ggplot(mod1, aes(x, predicted)) + geom_line(size=1) +
 geom_ribbon(aes(ymin = conf.low, ymax = conf.high),linetype = 3, alpha=0.2, colour = "black")))


#Cistus crispus
p1.1=plot_stabi_plant_2$plots[[1]] + geom_point(data = data_plant %>% filter(Plant_gen_sp == "Cistus crispus"), 
  aes(x =  asyn_LM, y = cv_1_visitation),color="#e41a1c",alpha=0.7, size=7)+ 
  labs(x = "",y="Stability of visitaion rate",subtitle = "Cistus crispus")+
  scale_y_continuous(limits = c(-5,9.5))+
   theme_bw()+theme( plot.subtitle = element_text(face = "italic"))


#Cistus ladanifer
p2.1=plot_stabi_plant_2$plots[[2]] + geom_point(data = data_plant %>% filter(Plant_gen_sp == "Cistus ladanifer"), 
  aes(x =  asyn_LM, y = cv_1_visitation),color="#377eb8", alpha=0.7,size=7)+ 
  labs(x = "",y=NULL,subtitle = "Cistus ladanifer")+ 
  scale_y_continuous(limits = c(-1.55,4))+
  theme_bw()+theme( plot.subtitle = element_text(face = "italic"))


#Cistus salviifolius
p3.1=plot_stabi_plant_2$plots[[3]] + geom_point(data = data_plant %>% filter(Plant_gen_sp == "Cistus salviifolius"), 
  aes(x =  asyn_LM, y = cv_1_visitation),color= "#4daf4a",alpha=0.7, size=7)+ 
  labs(x = "Asynchrony of pollinators",y= NULL,subtitle = "Cistus salviifolius")+ 
  scale_y_continuous(limits = c(-3,6))+
  theme_bw()+theme( plot.subtitle = element_text(face = "italic"))


#Halimium halimifolium
p4.1=plot_stabi_plant_2$plots[[4]] + geom_point(data = data_plant %>% filter(Plant_gen_sp == "Halimium halimifolium"), 
  aes(x =  asyn_LM, y = cv_1_visitation), color= "#984ea3", alpha=0.7,size=7)+   labs(x = "",y=NULL,subtitle = "Halimium halimifolium")+ 
  scale_y_continuous(limits = c(-0.7,3))+
  theme_bw() +theme( plot.subtitle = element_text(face = "italic"))


#Lavandula pedunculata
p5.1=plot_stabi_plant_2$plots[[5]] + geom_point(data = data_plant %>% filter(Plant_gen_sp == "Lavandula pedunculata"), 
  aes(x =  asyn_LM, y = cv_1_visitation), color="#ff7f00",alpha=0.7, size=7)+ 
  labs(x = "",y=NULL,subtitle = "Lavandula pedunculata")+  
  scale_y_continuous(limits = c(-0.7,4.7))+
  theme_bw() +theme( plot.subtitle = element_text(face = "italic"))



#join plot
p1.1+p2.1+p3.1+p4.1+p5.1+p1+p2+p3+p4+p5+plot_layout(ncol = 5)& theme(axis.title = element_text(face="bold"))&theme(text = element_text(size=30))


```

```{r,echo=FALSE, warning=FALSE,message=FALSE,fig.height = 13,fig.width=30,out.width="100%", fig.align='center',fig.cap=" 2. Interaction effect between richness and year (top row), and visitation rate and year (bottom row) on seed number. For the visualization purpose, we omit in the visitation rate (x-axis) the values outside of the 95\\%."}

# #scale seed number variable
Pollinator_Plant=Pollinator_Plant %>% 
  group_by(Plant_gen_sp) %>%
  mutate(seed_sc=scale(Seeds, center = T, scale = T))

#model3
mod3_to= lmer(seed_sc ~S_total * Year + (1|Site_ID/Plant_gen_sp),data=Pollinator_Plant)

#getting effects for the two variables
ee_mod3 <- as.data.frame(Effect(c("S_total","Year"),mod = mod3_to))

p3=ggplot(ee_mod3, aes(S_total,fit))+
  geom_line(size=0.8)+ 
  geom_ribbon(aes(ymin = lower, ymax = upper), alpha = .2)+
  geom_point(data= Pollinator_Plant, aes(x = S_total , y = seed_sc),shape=21, fill="grey", size=6)+
  labs(x = "Pollinator richness",y="Seed number")+
  ylim(-3,3)+
  facet_wrap(~Year, nrow = 1) + 
  theme_bw ()+
  theme(legend.position = "none")

#model4
mod4_to= lmer(seed_sc ~ visitatio_rate*Year + (1|Site_ID/Plant_gen_sp),data=Pollinator_Plant)


#getting effects for the two variables
ee_mod4 <- as.data.frame(Effect(c("visitatio_rate","Year"),mod = mod4_to))

#plot

p4 = ggplot(ee_mod4, aes(visitatio_rate,fit))+
  geom_line(size=0.8)+
  geom_ribbon(aes(ymin = lower, ymax = upper), alpha = .2)+
  geom_point(data= Pollinator_Plant, aes(x =visitatio_rate , y = seed_sc),shape=21, fill="grey",size=6)+
  labs(x = "Visitation rate",y="Seed number")+
  facet_wrap(~Year, nrow = 1) + 
  coord_cartesian(xlim=c(0, quantile(Pollinator_Plant$visitatio_rate,0.95)),ylim = c(-3,3))+
  theme_bw ()+
  theme(legend.position="none")

p3/p4 &theme(text = element_text(size=35))

```

# References
