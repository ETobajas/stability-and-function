
---
title: "Summary of models"
output: pdf_document
date: '2022-07-08'

header-includes:
- \usepackage{pdflscape}
- \newcommand{\blandscape}{\begin{landscape}}
- \newcommand{\elandscape}{\end{landscape}}

---

Data base from beefun: plant individuals per sites (13 sites) for five years (2015-2019). Data base has 400 observation, only matching individuals, some with no pollinator frequency (16 observations).
Fruit proportions, seed numbers and seed weight are calculated for each plant individual per plant species in site and year. Richness, visitation rate and frequency of pollinators are also calculated for plant individual per plant species. 
16 plant species but 4 are removed because they are present only one site. 

# Correlation

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="80%", fig.align='left'}
library(tidyverse)
#install.packages("broom.mixed")
library(broom.mixed)
library(broom)
#install.packages("lmerTest")
library(lmerTest)
library(dplyr)
library(knitr)
library(kableExtra)

Pollinator_Plant<- read.csv("../Data/Pollinator_Plant_Apis_separada.csv") 
Pollinator_Plant<-Pollinator_Plant[,-1]


#Species out
spp_out <- Pollinator_Plant %>%
  group_by(Plant_gen_sp) %>%
  summarise(Unique_Id = n_distinct(Site_ID)) %>%
  filter(Unique_Id == 1) %>%
  select(Plant_gen_sp) %>% pull(Plant_gen_sp)


#Data with species in more than 1 site
Pollinator_Plant = Pollinator_Plant %>% filter(!Plant_gen_sp %in% spp_out)


# correlation
a<-Pollinator_Plant %>% select(Plant_gen_sp,fruit_proportion, Seeds,Seed_weight,richness,visitatio_rate,Frequency)
a <- mutate_all(a, ~replace(., is.na(.), 0))

a_cor <- a %>%
  group_by(Plant_gen_sp) %>%
  do(cormat = cor(select(., -matches("Plant_gen_sp")))) 

list_1 <- a_cor[[2]]

v <- a_cor[[1]]
names(list_1) <- v

data2 <- do.call(rbind.data.frame, list_1)

corre<-data2 %>%
mutate(newcolum = rownames(data2))%>%
separate(newcolum, into=c('species', 'rows'), extra = "merge", sep = "\\.")%>%
select(species, rows,everything())  %>%
remove_rownames() %>%
  mutate(species = replace(species, duplicated(species), ""))

corre %>% 
   kable(booktabs = TRUE,digits =  4,longtable = T,linesep = c("","","","","","\\addlinespace"),align = "llcccccc") %>%
  kable_styling(font_size = 9,full_width = F, position="left")

```

\newpage

\blandscape

```{r, echo=FALSE, warning=FALSE,message=FALSE, figures-side,fig.height = 13,fig.width=18, out.width="100%",fig.fullwidth=TRUE}

library(tidyverse)
library(broom.mixed)
library(broom)
library(lmerTest)
library(dplyr)
library(knitr)
library(kableExtra)
library(patchwork)
library(ggcorrplot)
library(ggpubr)


df_with_plots <- a %>%
  group_by(Plant_gen_sp) %>%
  nest() %>%
  mutate(plot = map(data, function(.x) {
    .x  %>%
      cor() %>%
      ggcorrplot::ggcorrplot(show.diag = F, type="lower",lab=TRUE,lab_size=4,tl.cex=12)
  }))

plots1 <- map2(df_with_plots$plot, df_with_plots$Plant_gen_sp, ~(.x + labs(title = .y)))


ggarrange(plots1[[1]], plots1[[2]], plots1[[3]], plots1[[4]],plots1[[5]],plots1[[6]], plots1[[7]], plots1[[8]], plots1[[9]], plots1[[10]],plots1[[11]],plots1[[12]], ncol=4, nrow=3, common.legend = TRUE, legend="right")



```


\elandscape

## general correlation 
```{r,echo=FALSE, warning=FALSE,message=FALSE,fig.height = 13,fig.width=15, out.width="100%"}
# replace NAs by 0
# hay especies de plantas que presentan datos de fruit y seed pero no de polinizador (durante el tiempo observado no se ve ningun polinizador )
Pollinator_Plant <- mutate_all(Pollinator_Plant, ~replace(., is.na(.), 0))

cor_general<-Pollinator_Plant %>% 
  select(fruit_proportion, Seeds,Seed_weight,richness,visitatio_rate,Frequency)

corr <- round(cor(cor_general), 4)

corr %>% 
    kable("latex",booktabs = TRUE,linesep = "")

```



```{r,,echo=FALSE, warning=FALSE,message=FALSE, out.width="89%"}
ggcorrplot(corr, hc.order = TRUE, type = "lower",
           lab = TRUE)
```

\newpage

# Fruit proportion

## Richness

```{r,echo=FALSE, warning=FALSE,message=FALSE,fig.height = 13,fig.width=15, out.width="100%"}

# replace NAs by 0
# hay especies de plantas que presentan datos de fruit y seed pero no de polinizador (durante el tiempo observado no se ve ningun polinizador )
Pollinator_Plant <- mutate_all(Pollinator_Plant, ~replace(., is.na(.), 0))

#plot
plots_fruitproportion <- Pollinator_Plant %>%
  group_by(Plant_gen_sp) %>%
  group_map(~ ggplot(.) + aes(x=richness, y=fruit_proportion) + 
   geom_point() + ggtitle(.y[[1]]))

ggarrange(plots_fruitproportion[[1]],plots_fruitproportion[[2]],plots_fruitproportion[[3]],plots_fruitproportion[[4]],plots_fruitproportion[[5]],plots_fruitproportion[[6]],plots_fruitproportion[[7]],plots_fruitproportion[[8]],plots_fruitproportion[[9]],plots_fruitproportion[[10]],plots_fruitproportion[[11]],plots_fruitproportion[[12]], ncol=3, nrow=4)

```


\newpage

Summary of models for fruit proportion ~ pollinator richness per plant species. Binomial cbind(fruit_formado, Fruit_No), fruit formada= Fruit yes + fruit preyed + fruit dispersed. Site_ID as factor random

Note: NAs is replaced by zero. The plant species have fruit and seed data but no pollinator visiting were registered. No pollinator visit the plant species during observed time 

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%"}

#Models _ fruit proportion 
# richnes

mod_fruitproportion<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(glmer(cbind(fruit_formado, Fruit_No)~richness + (1|Site_ID),family=binomial,data)))%>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()

opts <- options(knitr.kable.NA = "")

mod_fruitproportion<-mod_fruitproportion %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
mod_fruitproportion<-filter(mod_fruitproportion, !term == "sd__(Intercept)")


mod_fruitproportion %>% 
    kable("latex",booktabs = TRUE,digits =  4, linesep = c("","\\addlinespace")) %>% 
column_spec(6, bold = ifelse(mod_fruitproportion$p.value < 0.05, T, F) )%>%
  kable_styling(position="center", latex_option="hold_position")

```


\newpage

```{r,echo=FALSE, warning=FALSE,message=FALSE, out.width="80%"}

mod_fruitproportion_glance<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(glmer(cbind(fruit_formado, Fruit_No)~richness + (1|Site_ID),family=binomial,data))) %>%
  summarize(glance(model))%>%
  ungroup()

mod_fruitproportion_glance %>% 
 kable("latex",booktabs = TRUE, digits =  3,linesep = "",align = "lccccccc")%>%
  kable_styling(font_size = 8,full_width = F, position="center")

```



```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%", fig.align='center'}

# model plot
mod_fruitproportion.1 <- Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(glmer(cbind(fruit_formado, Fruit_No)~richness + (1|Site_ID),family=binomial,data))) %>%
  mutate(model1 = list(ggeffects::ggpredict(model, terms = "richness"))) %>%
  mutate(plots = list(ggplot(model1, aes(x, predicted)) + geom_line() +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = .2)))


p1= mod_fruitproportion.1$plots[[1]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Asphodelus fistulosus"), aes(x =  richness, y = fruit_proportion),shape=20)+ labs(x = "richness",y="fruit proportion",subtitle = "A.fistulosus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p2= mod_fruitproportion.1$plots[[2]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus crispus"), aes(x =  richness, y = fruit_proportion),shape=20)+ labs(x = "richness",y="fruit proportion",subtitle = "C.crispus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p3= mod_fruitproportion.1$plots[[3]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus ladanifer"), aes(x =  richness, y = fruit_proportion),shape=20)+labs(x = "richness",y="fruit proportion",subtitle = "C.ladanifer")+  theme_classic()+theme(text = element_text(size=rel(3)))

p4= mod_fruitproportion.1$plots[[4]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus libanotis"), aes(x =  richness, y = fruit_proportion),shape=20)+ labs(x = "richness",y="fruit proportion",subtitle = "C.libanotis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p5= mod_fruitproportion.1$plots[[5]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus monspeliensis"), aes(x =  richness, y = fruit_proportion),shape=20)+labs(x = "richness",y="fruit proportion",subtitle = "C.monspeliensis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p6= mod_fruitproportion.1$plots[[6]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus salviifolius"), aes(x =  richness, y = fruit_proportion),shape=20)+ labs(x = "richness",y="fruit proportion",subtitle = "C.salviifolius")+  theme_classic()+theme(text = element_text(size=rel(3)))

p7= mod_fruitproportion.1$plots[[7]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium calycinum"), aes(x =  richness, y = fruit_proportion),shape=20)+ labs(x = "richness",y="fruit proportion",subtitle = "H.calycinum")+  theme_classic()+theme(text = element_text(size=rel(3)))

p8= mod_fruitproportion.1$plots[[8]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium halimifolium"), aes(x =  richness, y = fruit_proportion),shape=20)+ labs(x = "richness",y="fruit proportion",subtitle = "H.halimifolium")+  theme_classic()+theme(text = element_text(size=rel(3)))

p9= mod_fruitproportion.1$plots[[9]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula pedunculata"), aes(x =  richness, y = fruit_proportion),shape=20)+ labs(x = "richness",y="fruit proportion",subtitle = "L.pedunculata")+  theme_classic()+theme(text = element_text(size=rel(3)))

p10= mod_fruitproportion.1$plots[[10]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula stoechas"), aes(x =  richness, y = fruit_proportion),shape=20)+ labs(x = "richness",y="fruit proportion",subtitle = "L.stoechas")+  theme_classic()+theme(text = element_text(size=rel(3)))

p11= mod_fruitproportion.1$plots[[11]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Salvia rosmarinus"), aes(x =  richness, y = fruit_proportion),shape=20)+ labs(x = "richness",y="fruit proportion",subtitle = "S.rosmarinus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p12= mod_fruitproportion.1$plots[[12]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Teucrium fruticans"), aes(x =  richness, y = fruit_proportion),shape=20)+ labs(x = "richness",y="fruit proportion",subtitle = "T.fruticans")+  theme_classic()+theme(text = element_text(size=rel(3)))

p1+p2+p3+p4+p5+p6+p7+p8+p9+p10+p11+p12

```

\newpage

## Visitation rate

Visitation rate of all pollinators (hymenoptera, diptera and coleoptera) is calculated like frequency/ flower abundance

```{r,echo=FALSE, warning=FALSE,message=FALSE,fig.height = 13,fig.width=15, out.width="100%"}
#plot
plots_fruitproportion_2 <- Pollinator_Plant %>%
  group_by(Plant_gen_sp) %>%
  group_map(~ ggplot(.) + aes(x=visitatio_rate, y=fruit_proportion) + 
              geom_point() + ggtitle(.y[[1]]))

ggarrange(plots_fruitproportion_2[[1]],plots_fruitproportion_2[[2]],plots_fruitproportion_2[[3]],plots_fruitproportion_2[[4]],plots_fruitproportion_2[[5]],plots_fruitproportion_2[[6]],plots_fruitproportion_2[[7]],plots_fruitproportion_2[[8]],plots_fruitproportion_2[[9]],plots_fruitproportion_2[[10]],plots_fruitproportion_2[[11]],plots_fruitproportion_2[[12]], ncol=3, nrow=4)

```

\newpage

Summary of models for fruit proportion ~ visitation rate per plant species. Binomial cbind(fruit_formado, Fruit_No), fruit formada= Fruit yes + fruit preyed + fruit dispersed. Site_ID as factor random

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%"}

# visistation rate
mod_fruitproportion_2<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(glmer(cbind(fruit_formado, Fruit_No)~visitatio_rate + (1|Site_ID),family=binomial,data)))%>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()

opts <- options(knitr.kable.NA = "")

mod_fruitproportion_2<-mod_fruitproportion_2 %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
mod_fruitproportion_2<-filter(mod_fruitproportion_2, !term == "sd__(Intercept)")


mod_fruitproportion_2 %>% 
kable("latex",booktabs = TRUE,digits =  4, linesep = c("","\\addlinespace")) %>% 
column_spec(6, bold = ifelse(mod_fruitproportion_2$p.value < 0.05, T, F) )%>%
  kable_styling(position="center", latex_option="hold_position")

```

```{r,echo=FALSE, warning=FALSE,message=FALSE, out.width="80%"}

mod_fruitproportion_2_glance<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(glmer(cbind(fruit_formado, Fruit_No)~visitatio_rate + (1|Site_ID),family=binomial,data))) %>%
  summarize(glance(model))%>%
  ungroup()

mod_fruitproportion_2_glance %>% 
 kable("latex",booktabs = TRUE, digits =  3,linesep = "",align = "lccccccc")%>%
  kable_styling(font_size = 8,full_width = F, position="center")
```

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%", fig.align='center'}

# model plot 
mod_fruitproportion.2 <- Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(glmer(cbind(fruit_formado, Fruit_No)~visitatio_rate + (1|Site_ID),family=binomial,data))) %>%
  mutate(model1 = list(ggeffects::ggpredict(model, terms = "visitatio_rate"))) %>%
  mutate(plots = list(ggplot(model1, aes(x, predicted)) + geom_line() +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = .2)))


p1= mod_fruitproportion.2$plots[[1]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Asphodelus fistulosus"), aes(x =  visitatio_rate, y = fruit_proportion),shape=20)+ labs(x = "visitation_rate",y="fruit proportion",subtitle = "A.fistulosus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p2= mod_fruitproportion.2$plots[[2]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus crispus"), aes(x =  visitatio_rate, y = fruit_proportion),shape=20)+ labs(x = "visitation_rate",y="fruit proportion",subtitle = "C.crispus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p3=mod_fruitproportion.2$plots[[3]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus ladanifer"), aes(x =  visitatio_rate, y = fruit_proportion),shape=20)+labs(x = "visitation_rate",y="fruit proportion",subtitle = "C.ladanifer")+  theme_classic()+theme(text = element_text(size=rel(3)))

p4= mod_fruitproportion.2$plots[[4]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus libanotis"), aes(x =  visitatio_rate, y = fruit_proportion),shape=20)+labs(x = "visitation_rate",y="fruit proportion",subtitle = "C.libanotis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p5= mod_fruitproportion.2$plots[[5]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus monspeliensis"), aes(x =  visitatio_rate, y = fruit_proportion),shape=20)+ labs(x = "visitation_rate",y="fruit proportion",subtitle = "C.monspeliensis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p6= mod_fruitproportion.2$plots[[6]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus salviifolius"), aes(x =  visitatio_rate, y = fruit_proportion),shape=20)+ labs(x = "visitation_rate",y="fruit proportion",subtitle = "C.salviifolius")+  theme_classic()+theme(text = element_text(size=rel(3)))

p7= mod_fruitproportion.2$plots[[7]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium calycinum"), aes(x =  visitatio_rate, y = fruit_proportion),shape=20)+labs(x = "visitation_rate",y="fruit proportion",subtitle = "H.calycinum")+  theme_classic()+theme(text = element_text(size=rel(3)))

p8= mod_fruitproportion.2$plots[[8]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium halimifolium"), aes(x =  visitatio_rate, y = fruit_proportion),shape=20)+ labs(x = "visitation_rate",y="fruit proportion",subtitle = "H.halimifolium")+  theme_classic()+theme(text = element_text(size=rel(3)))

p9= mod_fruitproportion.2$plots[[9]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula pedunculata"), aes(x =  visitatio_rate, y = fruit_proportion),shape=20)+labs(x = "visitation_rate",y="fruit proportion",subtitle = "L.pedunculata")+  theme_classic()+theme(text = element_text(size=rel(3)))

p10= mod_fruitproportion.2$plots[[10]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula stoechas"), aes(x =  visitatio_rate, y = fruit_proportion),shape=20)+labs(x = "visitation_rate",y="fruit proportion",subtitle = "L.stoechas")+  theme_classic()+theme(text = element_text(size=rel(3)))

p11=mod_fruitproportion.2$plots[[11]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Salvia rosmarinus"), aes(x =  visitatio_rate, y = fruit_proportion),shape=20)+ labs(x = "visitation_rate",y="fruit proportion",subtitle = "S.rosmarinus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p12= mod_fruitproportion.2$plots[[12]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Teucrium fruticans"), aes(x =  visitatio_rate, y = fruit_proportion),shape=20)+labs(x = "visitation_rate",y="fruit proportion",subtitle = "T.fruticans")+  theme_classic()+theme(text = element_text(size=rel(3)))

p1+p2+p3+p4+p5+p6+p7+p8+p9+p10+p11+p12

```

\newpage

## Visitation rate of pollinators without Apis mellifera

visitation rate (frequency/ flower abundance) is calculated to all pollinators no apis mellifera.

```{r,echo=FALSE, warning=FALSE,message=FALSE,fig.height = 13,fig.width=15, out.width="100%"}
#plot
#plot
plots_fruitproportion_polli_no_apis <- Pollinator_Plant %>%
  group_by(Plant_gen_sp) %>%
  group_map(~ ggplot(.) + aes(x=No_Apis_visit_rate, y=fruit_proportion) + 
  geom_point() + ggtitle(.y[[1]]))

ggarrange(plots_fruitproportion_polli_no_apis[[1]],plots_fruitproportion_polli_no_apis[[2]],plots_fruitproportion_polli_no_apis[[3]],plots_fruitproportion_polli_no_apis[[4]],plots_fruitproportion_polli_no_apis[[5]],plots_fruitproportion_polli_no_apis[[6]],plots_fruitproportion_polli_no_apis[[7]],plots_fruitproportion_polli_no_apis[[8]],plots_fruitproportion_polli_no_apis[[9]],plots_fruitproportion_polli_no_apis[[10]],plots_fruitproportion_polli_no_apis[[11]],plots_fruitproportion_polli_no_apis[[12]], ncol=3, nrow=4)

```

\newpage
```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%"}


mod_fruitproportion_polli_no_api<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(glmer(cbind(fruit_formado, Fruit_No)~No_Apis_visit_rate + (1|Site_ID),family=binomial,data)))%>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()

opts <- options(knitr.kable.NA = "")

mod_fruitproportion_polli_no_api<-mod_fruitproportion_polli_no_api %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
mod_fruitproportion_polli_no_api<-filter(mod_fruitproportion_polli_no_api, !term == "sd__(Intercept)")


mod_fruitproportion_polli_no_api %>% 
kable("latex",booktabs = TRUE,digits =  4, linesep = c("","\\addlinespace")) %>% 
column_spec(6, bold = ifelse(mod_fruitproportion_polli_no_api$p.value < 0.05, T, F) )%>%
  kable_styling(position="center", latex_option="hold_position")

```

```{r,echo=FALSE, warning=FALSE,message=FALSE, out.width="80%"}

mod_fruitproportion_polli_no_api_glance<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(glmer(cbind(fruit_formado, Fruit_No)~No_Apis_visit_rate + (1|Site_ID),family=binomial,data))) %>%
  summarize(glance(model))%>%
  ungroup()

mod_fruitproportion_polli_no_api_glance %>% 
 kable("latex",booktabs = TRUE, digits =  3,linesep = "",align = "lccccccc")%>%
  kable_styling(font_size = 8,full_width = F, position="center")
```

\newpage
Data were 'prettified'. Consider using `terms="No_Apis_visit_rate [all]"` to get smooth plots.
```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%", fig.align='center'}

# model plot 
mod_fruitproportion_polli_no_api.2 <- Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(glmer(cbind(fruit_formado, Fruit_No)~No_Apis_visit_rate + (1|Site_ID),family=binomial,data))) %>%
  mutate(model1 = list(ggeffects::ggpredict(model, terms = "No_Apis_visit_rate"))) %>%
  mutate(plots = list(ggplot(model1, aes(x, predicted)) + geom_line() +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = .2)))


p1= mod_fruitproportion_polli_no_api.2$plots[[1]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Asphodelus fistulosus"), aes(x =  No_Apis_visit_rate, y = fruit_proportion),shape=20)+ labs(x = "visit_rate(no A.mellifera)",y="fruit proportion",subtitle = "A.fistulosus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p2= mod_fruitproportion_polli_no_api.2$plots[[2]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus crispus"), aes(x =  No_Apis_visit_rate, y = fruit_proportion),shape=20)+ labs(x = "visit_rate(no A.mellifera)",y="fruit proportion",subtitle = "C.crispus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p3=mod_fruitproportion_polli_no_api.2$plots[[3]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus ladanifer"), aes(x =  No_Apis_visit_rate, y = fruit_proportion),shape=20)+labs(x = "visit_rate(no A.mellifera)",y="fruit proportion",subtitle = "C.ladanifer")+  theme_classic()+theme(text = element_text(size=rel(3)))

p4= mod_fruitproportion_polli_no_api.2$plots[[4]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus libanotis"), aes(x =  No_Apis_visit_rate, y = fruit_proportion),shape=20)+labs(x = "visit_rate(no A.mellifera)",y="fruit proportion",subtitle = "C.libanotis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p5= mod_fruitproportion_polli_no_api.2$plots[[5]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus monspeliensis"), aes(x =  No_Apis_visit_rate, y = fruit_proportion),shape=20)+ labs(x = "visit_rate(no A.mellifera)",y="fruit proportion",subtitle = "C.monspeliensis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p6= mod_fruitproportion_polli_no_api.2$plots[[6]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus salviifolius"), aes(x =  No_Apis_visit_rate, y = fruit_proportion),shape=20)+ labs(x = "visit_rate(no A.mellifera)",y="fruit proportion",subtitle = "C.salviifolius")+  theme_classic()+theme(text = element_text(size=rel(3)))

p7= mod_fruitproportion_polli_no_api.2$plots[[7]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium calycinum"), aes(x =  No_Apis_visit_rate, y = fruit_proportion),shape=20)+labs(x = "visit_rate(no A.mellifera)",y="fruit proportion",subtitle = "H.calycinum")+  theme_classic()+theme(text = element_text(size=rel(3)))

p8= mod_fruitproportion_polli_no_api.2$plots[[8]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium halimifolium"), aes(x =  No_Apis_visit_rate, y = fruit_proportion),shape=20)+ labs(x = "visit_rate(no A.mellifera)",y="fruit proportion",subtitle = "H.halimifolium")+  theme_classic()+theme(text = element_text(size=rel(3)))

p9= mod_fruitproportion_polli_no_api.2$plots[[9]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula pedunculata"), aes(x =  No_Apis_visit_rate, y = fruit_proportion),shape=20)+labs(x = "visit_rate(no A.mellifera)",y="fruit proportion",subtitle = "L.pedunculata")+  theme_classic()+theme(text = element_text(size=rel(3)))

p10= mod_fruitproportion_polli_no_api.2$plots[[10]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula stoechas"), aes(x =  No_Apis_visit_rate, y = fruit_proportion),shape=20)+labs(x = "visit_rate(no A.mellifera)",y="fruit proportion",subtitle = "L.stoechas")+  theme_classic()+theme(text = element_text(size=rel(3)))

p11=mod_fruitproportion_polli_no_api.2$plots[[11]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Salvia rosmarinus"), aes(x =  No_Apis_visit_rate, y = fruit_proportion),shape=20)+ labs(x = "visit_rate(no A.mellifera)",y="fruit proportion",subtitle = "S.rosmarinus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p12= mod_fruitproportion_polli_no_api.2$plots[[12]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Teucrium fruticans"), aes(x =  No_Apis_visit_rate, y = fruit_proportion),shape=20)+labs(x = "visit_rate(no A.mellifera)",y="fruit proportion",subtitle = "T.fruticans")+  theme_classic()+theme(text = element_text(size=rel(3)))

p1+p2+p3+p4+p5+p6+p7+p8+p9+p10+p11+p12

```

\newpage

## Apis mellifera visitation rate

Only data of Apis mellifera

Problemas C.libanotis 
Warning messages:
1: In vcov.merMod(object, use.hessian = use.hessian) :
  variance-covariance matrix computed from finite-difference Hessian is
not positive definite or contains NA values: falling back to var-cov estimated from RX
2: In vcov.merMod(object, correlation = correlation, sigm = sig) :
  variance-covariance matrix computed from finite-difference Hessian is
not positive definite or contains NA values: falling back to var-cov estimated from RX

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%"}

# visistation rate A.mellifera
mod_fruitproportion__apis<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(glmer(cbind(fruit_formado, Fruit_No)~Apis_visit_rate + (1|Site_ID),family=binomial,data)))%>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()

opts <- options(knitr.kable.NA = "")

mod_fruitproportion__apis<-mod_fruitproportion__apis %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
mod_fruitproportion__apis<-filter(mod_fruitproportion__apis, !term == "sd__(Intercept)")


mod_fruitproportion__apis %>% 
kable("latex",booktabs = TRUE, digits =  4, linesep = c("","\\addlinespace")) %>% 
column_spec(6, bold = ifelse(mod_fruitproportion__apis$p.value < 0.05, T, F) )%>%
  kable_styling(position="center", latex_option="hold_position")

```

```{r,echo=FALSE, warning=FALSE,message=FALSE, out.width="80%"}

mod_fruitproportion__apis_glance<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(glmer(cbind(fruit_formado, Fruit_No)~Apis_visit_rate + (1|Site_ID),family=binomial,data))) %>%
  summarize(glance(model))%>%
  ungroup()

mod_fruitproportion__apis_glance %>% 
 kable("latex",booktabs = TRUE, digits =  3,linesep = "",align = "lccccccc")%>%  kable_styling(font_size = 8,full_width = F, position="center")
```

\newpage
Data were 'prettified'. Consider using `terms="Apis_visit_rate [all]"` to get smooth plots.
```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%", fig.align='center'}

# model plot 
mod_fruitproportion__apis.2 <- Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(glmer(cbind(fruit_formado, Fruit_No)~Apis_visit_rate + (1|Site_ID),family=binomial,data))) %>%
  mutate(model1 = list(ggeffects::ggpredict(model, terms ="Apis_visit_rate")))   %>%
  mutate(plots = list(ggplot(model1, aes(x, predicted)) + geom_line() +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = .2)))


p1= mod_fruitproportion__apis.2$plots[[1]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Asphodelus fistulosus"), aes(x =  Apis_visit_rate, y = fruit_proportion),shape=20)+ labs(x = "Apis_visit_rate",y="fruit proportion",subtitle = "A.fistulosus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p2= mod_fruitproportion__apis.2$plots[[2]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus crispus"), aes(x =  Apis_visit_rate, y = fruit_proportion),shape=20)+ labs(x = "Apis_visit_rate",y="fruit proportion",subtitle = "C.crispus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p3=mod_fruitproportion__apis.2$plots[[3]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus ladanifer"), aes(x =  Apis_visit_rate, y = fruit_proportion),shape=20)+labs(x = "Apis_visit_rate",y="fruit proportion",subtitle = "C.ladanifer")+  theme_classic()+theme(text = element_text(size=rel(3)))

p4= mod_fruitproportion__apis.2$plots[[4]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus libanotis"), aes(x =  Apis_visit_rate, y = fruit_proportion),shape=20)+labs(x = "Apis_visit_rate",y="fruit proportion",subtitle = "C.libanotis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p5= mod_fruitproportion__apis.2$plots[[5]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus monspeliensis"), aes(x =  Apis_visit_rate, y = fruit_proportion),shape=20)+ labs(x = "Apis_visit_rate",y="fruit proportion",subtitle = "C.monspeliensis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p6= mod_fruitproportion__apis.2$plots[[6]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus salviifolius"), aes(x =  Apis_visit_rate, y = fruit_proportion),shape=20)+ labs(x = "Apis_visit_rate",y="fruit proportion",subtitle = "C.salviifolius")+  theme_classic()+theme(text = element_text(size=rel(3)))

p7= mod_fruitproportion__apis.2$plots[[7]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium calycinum"), aes(x =  Apis_visit_rate, y = fruit_proportion),shape=20)+labs(x = "Apis_visit_rate",y="fruit proportion",subtitle = "H.calycinum")+  theme_classic()+theme(text = element_text(size=rel(3)))

p8= mod_fruitproportion__apis.2$plots[[8]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium halimifolium"), aes(x =  Apis_visit_rate, y = fruit_proportion),shape=20)+ labs(x = "Apis_visit_rate",y="fruit proportion",subtitle = "H.halimifolium")+  theme_classic()+theme(text = element_text(size=rel(3)))

p9= mod_fruitproportion__apis.2$plots[[9]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula pedunculata"), aes(x =  Apis_visit_rate, y = fruit_proportion),shape=20)+labs(x = "Apis_visit_rate",y="fruit proportion",subtitle = "L.pedunculata")+  theme_classic()+theme(text = element_text(size=rel(3)))

p10= mod_fruitproportion__apis.2$plots[[10]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula stoechas"), aes(x =  Apis_visit_rate, y = fruit_proportion),shape=20)+labs(x = "Apis_visit_rate",y="fruit proportion",subtitle = "L.stoechas")+  theme_classic()+theme(text = element_text(size=rel(3)))

p11=mod_fruitproportion__apis.2$plots[[11]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Salvia rosmarinus"), aes(x =  Apis_visit_rate, y = fruit_proportion),shape=20)+ labs(x = "Apis_visit_rate",y="fruit proportion",subtitle = "S.rosmarinus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p12= mod_fruitproportion__apis.2$plots[[12]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Teucrium fruticans"), aes(x =  Apis_visit_rate, y = fruit_proportion),shape=20)+labs(x = "Apis_visit_rate",y="fruit proportion",subtitle = "T.fruticans")+  theme_classic()+theme(text = element_text(size=rel(3)))

p1+p2+p3+p4+p5+p6+p7+p8+p9+p10+p11+p12

```

\newpage

## Hymenoptera visitation

Hymenoptera visitation is calculated like hymenoptera frequency / Flower abundance
```{r,echo=FALSE, warning=FALSE,message=FALSE,fig.height = 13,fig.width=15, out.width="100%"}
#plot
plots_fruitproportion_3 <- Pollinator_Plant %>%
  group_by(Plant_gen_sp) %>%
  group_map(~ ggplot(.) + aes(x=Hym_visit, y=fruit_proportion) + 
              geom_point() + ggtitle(.y[[1]]))

ggarrange(plots_fruitproportion_3[[1]],plots_fruitproportion_3[[2]],plots_fruitproportion_3[[3]],plots_fruitproportion_3[[4]],plots_fruitproportion_3[[5]],plots_fruitproportion_3[[6]],plots_fruitproportion_3[[7]],plots_fruitproportion_3[[8]],plots_fruitproportion_3[[9]],plots_fruitproportion_3[[10]],plots_fruitproportion_3[[11]],plots_fruitproportion_3[[12]], ncol=3, nrow=4)

```


\newpage

Summary of models for fruit proportion ~ Hymenoptera visitation per plant species. Binomial cbind(fruit_formado, Fruit_No), fruit formada= Fruit yes + fruit preyed + fruit dispersed. Site_ID as factor random
```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%"}

#Models _ fruit proportion 
# hymenoptera visitation
mod_plots_fruitproportion_3<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(glmer(cbind(fruit_formado, Fruit_No)~Hym_visit + (1|Site_ID),family=binomial,data)))%>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()

opts <- options(knitr.kable.NA = "")

mod_plots_fruitproportion_3<-mod_plots_fruitproportion_3 %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
mod_plots_fruitproportion_3<-filter(mod_plots_fruitproportion_3, !term == "sd__(Intercept)")


mod_plots_fruitproportion_3 %>% 
    kable("latex",booktabs = TRUE,digits =  4, linesep = c("","\\addlinespace")) %>% 
column_spec(6, bold = ifelse(mod_plots_fruitproportion_3$p.value < 0.05, T, F) )%>%
  kable_styling(position="center", latex_option="hold_position")

```

```{r,echo=FALSE, warning=FALSE,message=FALSE, out.width="80%"}

mod_fruitproportion_3_glance<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(glmer(cbind(fruit_formado, Fruit_No)~Hym_visit + (1|Site_ID),family=binomial,data))) %>%
  summarize(glance(model))%>%
  ungroup()

mod_fruitproportion_3_glance %>% 
 kable("latex",booktabs = TRUE, digits =  3,linesep = "",align = "lccccccc")%>%
  kable_styling(font_size = 8,full_width = F, position="center")
```

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%", fig.align='center'}

# model plot 
mod_fruitproportion.3 <- Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(glmer(cbind(fruit_formado, Fruit_No)~Hym_visit + (1|Site_ID),family=binomial,data))) %>%
  mutate(model1 = list(ggeffects::ggpredict(model, terms = "Hym_visit"))) %>%
  mutate(plots = list(ggplot(model1, aes(x, predicted)) + geom_line() +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = .2)))


p1=mod_fruitproportion.3$plots[[1]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Asphodelus fistulosus"), aes(x =  Hym_visit, y = fruit_proportion),shape=20)+ labs(x = "Hymenotera_visit",y="fruit proportion",subtitle = "A.fistulosus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p2=mod_fruitproportion.3$plots[[2]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus crispus"), aes(x =  Hym_visit, y = fruit_proportion),shape=20)+ labs(x = "Hymenotera_visit",y="fruit proportion",subtitle = "C.crispus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p3=mod_fruitproportion.3$plots[[3]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus ladanifer"), aes(x =  Hym_visit, y = fruit_proportion),shape=20)+ labs(x = "Hymenotera_visit",y="fruit proportion",subtitle = "C.ladanifer")+  theme_classic()+theme(text = element_text(size=rel(3)))

p4=mod_fruitproportion.3$plots[[4]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus libanotis"), aes(x =  Hym_visit, y = fruit_proportion),shape=20)+ labs(x = "Hymenotera_visit",y="fruit proportion",subtitle = "C.libanotis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p5=mod_fruitproportion.3$plots[[5]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus monspeliensis"), aes(x =  Hym_visit, y = fruit_proportion),shape=20)+ labs(x = "Hymenotera_visit",y="fruit proportion",subtitle = "C.monspeliensis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p6=mod_fruitproportion.3$plots[[6]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus salviifolius"), aes(x =  Hym_visit, y = fruit_proportion),shape=20)+labs(x = "Hymenotera_visit",y="fruit proportion",subtitle = "C.salviifolius")+  theme_classic()+theme(text = element_text(size=rel(3)))

p7= mod_fruitproportion.3$plots[[7]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium calycinum"), aes(x =  Hym_visit, y = fruit_proportion),shape=20)+ labs(x = "Hymenotera_visit",y="fruit proportion",subtitle = "H.calycinum")+  theme_classic()+theme(text = element_text(size=rel(3)))

p8=mod_fruitproportion.3$plots[[8]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium halimifolium"), aes(x =  Hym_visit, y = fruit_proportion),shape=20)+ labs(x = "Hymenotera_visit",y="fruit proportion",subtitle = "H.halimifolium")+  theme_classic()+theme(text = element_text(size=rel(3)))

p9=mod_fruitproportion.3$plots[[9]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula pedunculata"), aes(x =  Hym_visit, y = fruit_proportion),shape=20)+labs(x = "Hymenotera_visit",y="fruit proportion",subtitle = "L.pedunculata")+  theme_classic()+theme(text = element_text(size=rel(3)))

p10=mod_fruitproportion.3$plots[[10]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula stoechas"), aes(x =  Hym_visit, y = fruit_proportion),shape=20)+ labs(x = "Hymenotera_visit",y="fruit proportion",subtitle = "L.stoechas")+  theme_classic()+theme(text = element_text(size=rel(3)))

p11=mod_fruitproportion.3$plots[[11]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Salvia rosmarinus"), aes(x =  Hym_visit, y = fruit_proportion),shape=20)+labs(x = "Hymenotera_visit",y="fruit proportion",subtitle = "S.rosmarinus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p12=mod_fruitproportion.3$plots[[12]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Teucrium fruticans"), aes(x =  Hym_visit, y = fruit_proportion),shape=20)+ labs(x = "Hymenotera_visit",y="fruit proportion",subtitle = "T.fruticans")+  theme_classic()+theme(text = element_text(size=rel(3)))


p1+p2+p3+p4+p5+p6+p7+p8+p9+p10+p11+p12

```


\newpage


\newpage 

## Hymenoptera visitation rate without A.mellifera
```{r,echo=FALSE, warning=FALSE,message=FALSE,fig.height = 13,fig.width=15, out.width="100%"}
#plot
plots_fruitproportion_hyme_no_apis <- Pollinator_Plant %>%
  group_by(Plant_gen_sp) %>%
  group_map(~ ggplot(.) + aes(x=Hym_visit_sin_apis, y=fruit_proportion) + 
              geom_point() + ggtitle(.y[[1]]))

ggarrange(plots_fruitproportion_hyme_no_apis[[1]],plots_fruitproportion_hyme_no_apis[[2]],plots_fruitproportion_hyme_no_apis[[3]],plots_fruitproportion_hyme_no_apis[[4]],plots_fruitproportion_hyme_no_apis[[5]],plots_fruitproportion_hyme_no_apis[[6]],plots_fruitproportion_hyme_no_apis[[7]],plots_fruitproportion_hyme_no_apis[[8]],plots_fruitproportion_hyme_no_apis[[9]],plots_fruitproportion_hyme_no_apis[[10]],plots_fruitproportion_hyme_no_apis[[11]],plots_fruitproportion_hyme_no_apis[[12]], ncol=3, nrow=4)

```

\newpage

Problemas H.calycinum: unable to evaluate scaled gradient and Hessian is numerically singular: parameters are not uniquely determined
```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%"}

mod_fruitproportion_hyme_no_apis<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(glmer(cbind(fruit_formado, Fruit_No)~Hym_visit_sin_apis + (1|Site_ID),family=binomial,data)))%>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()

opts <- options(knitr.kable.NA = "")

mod_fruitproportion_hyme_no_apis<-mod_fruitproportion_hyme_no_apis %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
mod_fruitproportion_hyme_no_apis<-filter(mod_fruitproportion_hyme_no_apis, !term == "sd__(Intercept)")


mod_fruitproportion_hyme_no_apis %>% 
kable("latex",booktabs = TRUE,digits =  4, linesep = c("","\\addlinespace")) %>% 
column_spec(6, bold = ifelse(mod_fruitproportion_hyme_no_apis$p.value < 0.05, T, F) )%>%
  kable_styling(position="center", latex_option="hold_position")

```

```{r,echo=FALSE, warning=FALSE,message=FALSE, out.width="80%"}

mod_fruitproportion_hyme_no_apis_glance<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(glmer(cbind(fruit_formado, Fruit_No)~Hym_visit_sin_apis + (1|Site_ID),family=binomial,data))) %>%
  summarize(glance(model))%>%
  ungroup()

mod_fruitproportion_hyme_no_apis_glance %>% 
 kable("latex",booktabs = TRUE, digits =  3,linesep = "",align = "lccccccc")%>%
  kable_styling(font_size = 8,full_width = F, position="center")
```

\newpage
Data were 'prettified'. Consider using `terms="Hym_visit_sin_apis [all]"` to get smooth plots
```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%", fig.align='center'}

# model plot 
mod_fruitproportion_hyme_no_apis.2 <- Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(glmer(cbind(fruit_formado, Fruit_No)~Hym_visit_sin_apis + (1|Site_ID),family=binomial,data))) %>%
  mutate(model1 = list(ggeffects::ggpredict(model, terms = "Hym_visit_sin_apis"))) %>%
  mutate(plots = list(ggplot(model1, aes(x, predicted)) + geom_line() +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = .2)))


p1 = mod_fruitproportion_hyme_no_apis.2$plots[[1]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Asphodelus fistulosus"), aes(x =  Hym_visit_sin_apis, y = fruit_proportion),shape=20)+ 
  labs(x = "Hym_visit_sin_apis",y="fruit proportion",subtitle = "A.fistulosus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p2 = mod_fruitproportion_hyme_no_apis.2$plots[[2]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus crispus"), aes(x =  Hym_visit_sin_apis, y = fruit_proportion),shape=20)+ 
  labs(x = "Hym_visit_sin_apis",y="fruit proportion",subtitle = "C.crispus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p3 = mod_fruitproportion_hyme_no_apis.2$plots[[3]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus ladanifer"), aes(x =  Hym_visit_sin_apis, y = fruit_proportion),shape=20)+ 
  labs(x = "Hym_visit_sin_apis",y="fruit proportion",subtitle = "C.ladanifer")+  theme_classic()+theme(text = element_text(size=rel(3)))

p4 = mod_fruitproportion_hyme_no_apis.2$plots[[4]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus libanotis"), aes(x =  Hym_visit_sin_apis, y = fruit_proportion),shape=20)+ 
  labs(x = "Hym_visit_sin_apis",y="fruit proportion",subtitle = "C.libanotis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p5 = mod_fruitproportion_hyme_no_apis.2$plots[[5]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus monspeliensis"), aes(x =  Hym_visit_sin_apis, y = fruit_proportion),shape=20)+ 
  labs(x = "Hym_visit_sin_apis",y="fruit proportion",subtitle = "C.monspeliensis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p6 = mod_fruitproportion_hyme_no_apis.2$plots[[6]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus salviifolius"), aes(x =  Hym_visit_sin_apis, y = fruit_proportion),shape=20)+ 
  labs(x = "Hym_visit_sin_apis",y="fruit proportion",subtitle = "C.salviifolius")+  theme_classic()+theme(text = element_text(size=rel(3)))

p7 = mod_fruitproportion_hyme_no_apis.2$plots[[7]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium calycinum"), aes(x =  Hym_visit_sin_apis, y = fruit_proportion),shape=20)+ 
  labs(x = "Hym_visit_sin_apis",y="fruit proportion",subtitle = "H.calycinum")+  theme_classic()+theme(text = element_text(size=rel(3)))

p8 = mod_fruitproportion_hyme_no_apis.2$plots[[8]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium halimifolium"), aes(x =  Hym_visit_sin_apis, y = fruit_proportion),shape=20)+ 
  labs(x = "Hym_visit_sin_apis",y="fruit proportion",subtitle = "H.halimifolium")+  theme_classic()+theme(text = element_text(size=rel(3)))

p9 = mod_fruitproportion_hyme_no_apis.2$plots[[9]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula pedunculata"), aes(x =  Hym_visit_sin_apis, y = fruit_proportion),shape=20)+ 
  labs(x = "Hym_visit_sin_apis",y="fruit proportion",subtitle = "L.pedunculata")+  theme_classic()+theme(text = element_text(size=rel(3)))

p10 = mod_fruitproportion_hyme_no_apis.2$plots[[10]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula stoechas"), aes(x =  Hym_visit_sin_apis, y = fruit_proportion),shape=20)+ 
  labs(x = "Hym_visit_sin_apis",y="fruit proportion",subtitle = "L.stoechas")+  theme_classic()+theme(text = element_text(size=rel(3)))

p11 = mod_fruitproportion_hyme_no_apis.2$plots[[11]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Salvia rosmarinus"), aes(x =  Hym_visit_sin_apis, y = fruit_proportion),shape=20)+ 
  labs(x = "Hym_visit_sin_apis",y="fruit proportion",subtitle = "S.rosmarinus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p12 = mod_fruitproportion_hyme_no_apis.2$plots[[12]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Teucrium fruticans"), aes(x =  Hym_visit_sin_apis, y = fruit_proportion),shape=20)+ 
  labs(x = "Hym_visit_sin_apis",y="fruit proportion",subtitle = "T.fruticans")+  theme_classic()+theme(text = element_text(size=rel(3)))


p1+p2+p3+p4+p5+p6+p7+p8+p9+p10+p11+p12

```

## Pollinator frequency

```{r,echo=FALSE, warning=FALSE,message=FALSE,fig.height = 13,fig.width=15, out.width="100%"}
#plot
plots_fruitproportion_4 <- Pollinator_Plant %>%
  group_by(Plant_gen_sp) %>%
  group_map(~ ggplot(.) + aes(x=Frequency, y=fruit_proportion) + 
              geom_point() + ggtitle(.y[[1]]))

ggarrange(plots_fruitproportion_4[[1]],plots_fruitproportion_4[[2]],plots_fruitproportion_4[[3]],plots_fruitproportion_4[[4]],plots_fruitproportion_4[[5]],plots_fruitproportion_4[[6]],plots_fruitproportion_4[[7]],plots_fruitproportion_4[[8]],plots_fruitproportion_4[[9]],plots_fruitproportion_4[[10]],plots_fruitproportion_4[[11]],plots_fruitproportion_4[[12]], ncol=3, nrow=4)

```

\newpage

Summary of models for fruit proportion ~ pollinator frequency per plant species. Binomial cbind(fruit_formado, Fruit_No), fruit formada= Fruit yes + fruit preyed + fruit dispersed. Site_ID as factor random
```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%"}

# frequency
mod_fruitproportion_4<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(glmer(cbind(fruit_formado, Fruit_No)~Frequency + (1|Site_ID),family=binomial,data)))%>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()

opts <- options(knitr.kable.NA = "")

mod_fruitproportion_4<-mod_fruitproportion_4 %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
mod_fruitproportion_4<-filter(mod_fruitproportion_4, !term == "sd__(Intercept)")


mod_fruitproportion_4 %>% 
kable("latex",booktabs = TRUE,digits =  4, linesep = c("","\\addlinespace")) %>% 
column_spec(6, bold = ifelse(mod_fruitproportion_4$p.value < 0.05, T, F) )%>%
  kable_styling(position="center", latex_option="hold_position")

```

```{r,echo=FALSE, warning=FALSE,message=FALSE, out.width="80%"}

mod_fruitproportion_4_glance<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(glmer(cbind(fruit_formado, Fruit_No)~Frequency + (1|Site_ID),family=binomial,data))) %>%
  summarize(glance(model))%>%
  ungroup()

mod_fruitproportion_4_glance %>% 
 kable("latex",booktabs = TRUE, digits =  3,linesep = "",align = "lccccccc")%>%
  kable_styling(font_size = 8,full_width = F, position="center")
```

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%", fig.align='center'}

# model plot 
mod_fruitproportion.4 <- Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(glmer(cbind(fruit_formado, Fruit_No)~Frequency + (1|Site_ID),family=binomial,data))) %>%
  mutate(model1 = list(ggeffects::ggpredict(model, terms = "Frequency"))) %>%
  mutate(plots = list(ggplot(model1, aes(x, predicted)) + geom_line() +
 geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = .2)))



p1=mod_fruitproportion.4$plots[[1]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Asphodelus fistulosus"), aes(x =  Frequency, y = fruit_proportion),shape=20)+ labs(x = "Frequency",y="fruit proportion",subtitle = "A.fistulosus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p2=mod_fruitproportion.4$plots[[2]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus crispus"), aes(x =  Frequency, y = fruit_proportion),shape=20)+ labs(x = "Frequency",y="fruit proportion",subtitle = "C.crispus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p3=mod_fruitproportion.4$plots[[3]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus ladanifer"), aes(x =  Frequency, y = fruit_proportion),shape=20)+ labs(x = "Frequency",y="fruit proportion",subtitle = "C.ladanifer")+  theme_classic()+theme(text = element_text(size=rel(3)))

P4=mod_fruitproportion.4$plots[[4]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus libanotis"), aes(x =  Frequency, y = fruit_proportion),shape=20)+ labs(x = "Frequency",y="fruit proportion",subtitle = "C.libanotis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p5=mod_fruitproportion.4$plots[[5]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus monspeliensis"), aes(x =  Frequency, y = fruit_proportion),shape=20)+labs(x = "Frequency",y="fruit proportion",subtitle = "C.monspeliensis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p6=mod_fruitproportion.4$plots[[6]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus salviifolius"), aes(x =  Frequency, y = fruit_proportion),shape=20)+labs(x = "Frequency",y="fruit proportion",subtitle = "C.salviifolius")+  theme_classic()+theme(text = element_text(size=rel(3)))

p7=mod_fruitproportion.4$plots[[7]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium calycinum"), aes(x =  Frequency, y = fruit_proportion),shape=20)+labs(x = "Frequency",y="fruit proportion",subtitle = "H.calycinum")+  theme_classic()+theme(text = element_text(size=rel(3)))

p8= mod_fruitproportion.4$plots[[8]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium halimifolium"), aes(x =  Frequency, y = fruit_proportion),shape=20)+labs(x = "Frequency",y="fruit proportion",subtitle = "H.halimifolium")+  theme_classic()+theme(text = element_text(size=rel(3)))

p9=mod_fruitproportion.4$plots[[9]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula pedunculata"), aes(x =  Frequency, y = fruit_proportion),shape=20)+ labs(x = "Frequency",y="fruit proportion",subtitle = "L.pedunculata")+  theme_classic()+theme(text = element_text(size=rel(3)))

p10=mod_fruitproportion.4$plots[[10]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula stoechas"), aes(x =  Frequency, y = fruit_proportion),shape=20)+ labs(x = "Frequency",y="fruit proportion",subtitle = "L.stoechas")+  theme_classic()+theme(text = element_text(size=rel(3)))

p11=mod_fruitproportion.4$plots[[11]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Salvia rosmarinus"), aes(x =  Frequency, y = fruit_proportion),shape=20)+ labs(x = "Frequency",y="fruit proportion",subtitle = "S.rosmarinus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p12=mod_fruitproportion.4$plots[[12]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Teucrium fruticans"), aes(x =  Frequency, y = fruit_proportion),shape=20)+  labs(x = "Frequency",y="fruit proportion",subtitle = "T.fruticans")+  theme_classic()+theme(text = element_text(size=rel(3)))

p1+p2+p3+p4+p5+p6+p7+p8+p9+p10+p11+p12

```


\newpage


# Seed number

seed number is calculated like seed number mean per fruit in plant individual per plant species

## Richness

```{r,echo=FALSE, warning=FALSE,message=FALSE,fig.height = 13,fig.width=15, out.width="100%"}
#plot
plots_seed <- Pollinator_Plant %>%
  group_by(Plant_gen_sp) %>%
  group_map(~ ggplot(.) + aes(x=richness, y=Seeds) + 
              geom_point() + ggtitle(.y[[1]]))

ggarrange(plots_seed[[1]],plots_seed[[2]],plots_seed[[3]],plots_seed[[4]],plots_seed[[5]],plots_seed[[6]],plots_seed[[7]],plots_seed[[8]],plots_seed[[9]],plots_seed[[10]],plots_seed[[11]],plots_seed[[12]], ncol=3, nrow=4)

```

\newpage

Summary of models for seed numbers ~ richness per plant species (LMM). Site_ID as factor random

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%"}

#Models _ Seed numbers 
# richness
mod_seed<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seeds~richness+(1|Site_ID),data))) %>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()

opts <- options(knitr.kable.NA = "")

mod_seed<-mod_seed %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
mod_seed<-filter(mod_seed, !term == "sd__(Intercept)" & !term =="sd__Observation")


mod_seed %>% 
kable("latex", booktabs = TRUE,digits =  4, linesep = c("","\\addlinespace")) %>% column_spec(7, bold = ifelse(mod_seed$p.value < 0.05, T, F) )%>%
  kable_styling(position="center", latex_option="hold_position")

```

```{r,echo=FALSE, warning=FALSE,message=FALSE, out.width="80%"}

mod_seed_glance<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seeds~richness+(1|Site_ID),data))) %>%
  summarize(glance(model))%>%
  ungroup()

mod_seed_glance %>% 
 kable("latex",booktabs = TRUE, digits =  3,linesep = "",align = "lccccccc")%>%
  kable_styling(font_size = 8,full_width = F, position="center")
```

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%", fig.align='center'}

# model plot 
mod_seed.1 <- Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seeds~richness+(1|Site_ID),data))) %>%
  mutate(model1 = list(ggeffects::ggpredict(model, terms = "richness"))) %>%
  mutate(plots = list(ggplot(model1, aes(x, predicted)) + geom_line() +
 geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = .2)))



p1=mod_seed.1$plots[[1]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Asphodelus fistulosus"), aes(x =  richness, y = Seeds),shape=20)+ labs(x = "richness",y="seed_number",subtitle = "A.fistulosus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p2=mod_seed.1$plots[[2]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus crispus"), aes(x =  richness, y = Seeds),shape=20)+ labs(x = "richness",y="seed_number",subtitle = "C.crispus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p3=mod_seed.1$plots[[3]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus ladanifer"), aes(x =  richness, y = Seeds),shape=20)+ labs(x = "richness",y="seed_number",subtitle = "C.ladanifer")+  theme_classic()+theme(text = element_text(size=rel(3)))

p4=mod_seed.1$plots[[4]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus libanotis"), aes(x =  richness, y = Seeds),shape=20)+labs(x = "richness",y="seed_number",subtitle = "C.libanotis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p5=mod_seed.1$plots[[5]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus monspeliensis"), aes(x =  richness, y = Seeds),shape=20)+ labs(x = "richness",y="seed_number",subtitle = "C.monspeliensis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p6=mod_seed.1$plots[[6]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus salviifolius"), aes(x =  richness, y = Seeds),shape=20)+labs(x = "richness",y="seed_number",subtitle = "C.salviifolius")+  theme_classic()+theme(text = element_text(size=rel(3)))

p7=mod_seed.1$plots[[7]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium calycinum"), aes(x =  richness, y = Seeds),shape=20)+labs(x = "richness",y="seed_number",subtitle = "H.calycinum")+  theme_classic()+theme(text = element_text(size=rel(3)))

p8=mod_seed.1$plots[[8]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium halimifolium"), aes(x =  richness, y = Seeds),shape=20)+labs(x = "richness",y="seed_number",subtitle = "H.halimifolium")+  theme_classic()+theme(text = element_text(size=rel(3)))

p9=mod_seed.1$plots[[9]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula pedunculata"), aes(x =  richness, y = Seeds),shape=20)+ labs(x = "richness",y="seed_number",subtitle = "L.pedunculata")+  theme_classic()+theme(text = element_text(size=rel(3)))

p10=mod_seed.1$plots[[10]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula stoechas"), aes(x =  richness, y = Seeds),shape=20)+labs(x = "richness",y="seed_number",subtitle = "L.stoechas")+  theme_classic()+theme(text = element_text(size=rel(3)))

p11=mod_seed.1$plots[[11]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Salvia rosmarinus"), aes(x =  richness, y = Seeds),shape=20)+ labs(x = "richness",y="seed_number",subtitle = "S.rosmarinus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p12=mod_seed.1$plots[[12]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Teucrium fruticans"), aes(x =  richness, y = Seeds),shape=20)+ labs(x = "richness",y="seed_number",subtitle = "T.fruticans")+  theme_classic()+theme(text = element_text(size=rel(3)))


p1+p2+p3+p4+p5+p6+p7+p8+p9+p10+p11+p12

```


\newpage

## Visitation rate
Visitation rate of all pollinators (hymenoptera, diptera and coleoptera)

```{r,echo=FALSE, warning=FALSE,message=FALSE,fig.height = 13,fig.width=15, out.width="100%"}
#plot
plots_seed_2 <- Pollinator_Plant %>%
  group_by(Plant_gen_sp) %>%
  group_map(~ ggplot(.) + aes(x=visitatio_rate, y=Seeds) + 
              geom_point() + ggtitle(.y[[1]]))

ggarrange(plots_seed_2[[1]],plots_seed_2[[2]],plots_seed_2[[3]],plots_seed_2[[4]],plots_seed_2[[5]],plots_seed_2[[6]],plots_seed_2[[7]],plots_seed_2[[8]],plots_seed_2[[9]],plots_seed_2[[10]],plots_seed_2[[11]],plots_seed_2[[12]], ncol=3,nrow=4)

```

\newpage

Summary of models for seed number ~ visitation rate per plant species (LMM). Site_ID as factor random

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%"}

# visitation rate
mod_seed2<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seeds~visitatio_rate+(1|Site_ID),data))) %>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()

opts <- options(knitr.kable.NA = "")

mod_seed2<-mod_seed2 %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
mod_seed2<-filter(mod_seed2, !term == "sd__(Intercept)" & !term =="sd__Observation")


mod_seed2 %>% 
kable("latex", booktabs = TRUE,digits =  4, linesep = c("","\\addlinespace")) %>% column_spec(7, bold = ifelse(mod_seed2$p.value < 0.05, T, F) )%>%
  kable_styling(position="center", latex_option="hold_position")
```

```{r,echo=FALSE, warning=FALSE,message=FALSE, out.width="80%"}

mod_seed2_glance<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seeds~visitatio_rate+(1|Site_ID),data))) %>%
  summarize(glance(model))%>%
  ungroup()

mod_seed2_glance %>% 
 kable("latex",booktabs = TRUE, digits =  3,linesep = "",align = "lccccccc")%>%
  kable_styling(font_size = 8,full_width = F, position="center")
```

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%", fig.align='center'}

# model plot 
mod_seed.2 <- Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seeds~visitatio_rate+(1|Site_ID),data))) %>%
  mutate(model1 = list(ggeffects::ggpredict(model, terms = "visitatio_rate")))  %>%  mutate(plots = list(ggplot(model1, aes(x, predicted)) + geom_line() +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = .2)))


p1=mod_seed.2$plots[[1]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Asphodelus fistulosus"), aes(x =  visitatio_rate, y = Seeds),shape=20)+ labs(x = "visitation_rate",y="seed_number",subtitle = "A.fistulosus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p2=mod_seed.2$plots[[2]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus crispus"), aes(x =  visitatio_rate, y = Seeds),shape=20)+ labs(x = "visitation_rate",y="seed_number",subtitle = "C.crispus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p3=mod_seed.2$plots[[3]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus ladanifer"), aes(x =  visitatio_rate, y = Seeds),shape=20)+ labs(x = "visitation_rate",y="seed_number",subtitle = "C.ladanifer")+  theme_classic()+theme(text = element_text(size=rel(3)))

p4=mod_seed.2$plots[[4]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus libanotis"), aes(x =  visitatio_rate, y = Seeds),shape=20)+ labs(x = "visitation_rate",y="seed_number",subtitle = "C.libanotis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p5=mod_seed.2$plots[[5]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus monspeliensis"), aes(x =  visitatio_rate, y = Seeds),shape=20)+ labs(x = "visitation_rate",y="seed_number",subtitle = "C.monspeliensis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p6=mod_seed.2$plots[[6]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus salviifolius"), aes(x =  visitatio_rate, y = Seeds),shape=20)+ labs(x = "visitation_rate",y="seed_number",subtitle = "C.salviifolius")+  theme_classic()+theme(text = element_text(size=rel(3)))

p7=mod_seed.2$plots[[7]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium calycinum"), aes(x =  visitatio_rate, y = Seeds),shape=20)+ labs(x = "visitation_rate",y="seed_number",subtitle = "H.calycinum")+  theme_classic()+theme(text = element_text(size=rel(3)))

p8=mod_seed.2$plots[[8]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium halimifolium"), aes(x =  visitatio_rate, y = Seeds),shape=20)+labs(x = "visitation_rate",y="seed_number",subtitle = "H.halimifolium")+  theme_classic()+theme(text = element_text(size=rel(3)))

p9=mod_seed.2$plots[[9]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula pedunculata"), aes(x =  visitatio_rate, y = Seeds),shape=20)+labs(x = "visitation_rate",y="seed_number",subtitle = "L.pedunculata")+  theme_classic()+theme(text = element_text(size=rel(3)))

p10=mod_seed.2$plots[[10]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula stoechas"), aes(x =  visitatio_rate, y = Seeds),shape=20)+ labs(x = "visitation_rate",y="seed_number",subtitle = "L.stoechas")+  theme_classic()+theme(text = element_text(size=rel(3)))

p11= mod_seed.2$plots[[11]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Salvia rosmarinus"), aes(x =  visitatio_rate, y = Seeds),shape=20)+ labs(x = "visitation_rate",y="seed_number",subtitle = "S.rosmarinus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p12=mod_seed.2$plots[[12]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Teucrium fruticans"), aes(x =  visitatio_rate, y = Seeds),shape=20)+ labs(x = "visitation_rate",y="seed_number",subtitle = "T.fruticans")+  theme_classic()+theme(text = element_text(size=rel(3)))

p1+p2+p3+p4+p5+p6+p7+p8+p9+p10+p11+p12

```

\newpage

## Visitation rate of pollinators without Apis mellifera

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%"}

mod_seed_Vr_no_apis<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seeds~No_Apis_visit_rate+(1|Site_ID),data))) %>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()


opts <- options(knitr.kable.NA = "")

mod_seed_Vr_no_apis<-mod_seed_Vr_no_apis %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
mod_seed_Vr_no_apis<-filter(mod_seed_Vr_no_apis, !term == "sd__(Intercept)" & !term =="sd__Observation")


mod_seed_Vr_no_apis %>% 
kable("latex", booktabs = TRUE,digits =  4, linesep = c("","\\addlinespace")) %>% column_spec(7, bold = ifelse(mod_seed_Vr_no_apis$p.value < 0.05, T, F)) %>% kable_styling(position="center", latex_option="hold_position")

```

```{r,echo=FALSE, warning=FALSE,message=FALSE, out.width="80%"}

mod_seed_Vr_no_apis_glance<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seeds~No_Apis_visit_rate+(1|Site_ID),data))) %>%
  summarize(glance(model))%>%
  ungroup()

mod_seed_Vr_no_apis_glance %>% 
 kable("latex",booktabs = TRUE, digits =  3,linesep = "",align = "lccccccc")%>%  kable_styling(font_size = 8,full_width = F, position="center")

```

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%", fig.align='center'}

# model plot 
mod_seed_Vr_no_apis_trial.2 <- Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seeds~No_Apis_visit_rate+(1|Site_ID),data))) %>%
  mutate(model1 = list(ggeffects::ggpredict(model, terms = "No_Apis_visit_rate"))) %>%
  mutate(plots = list(ggplot(model1, aes(x, predicted)) + geom_line() +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = .2)))


p1 = mod_seed_Vr_no_apis_trial.2 $ plots[[1]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Asphodelus fistulosus"), aes(x = No_Apis_visit_rate, y = Seeds),shape=20) + labs(x = "No_Apis_visit_rate",y ="seed_number",subtitle = "A.fistulosus") + theme_classic()+theme(text = element_text(size=rel(3)))

p2 = mod_seed_Vr_no_apis_trial.2$plots[[2]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus crispus"), aes(x =  No_Apis_visit_rate, y = Seeds),shape=20) + labs(x = "No_Apis_visit_rate",y = "seed_number",subtitle = "C.crispus")+ theme_classic()+theme(text = element_text(size=rel(3)))

p3 = mod_seed_Vr_no_apis_trial.2$plots[[3]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus ladanifer"), aes(x =  No_Apis_visit_rate, y = Seeds),shape=20) + labs(x = "No_Apis_visit_rate",y = "seed_number",subtitle = "C.ladanifer")+ theme_classic()+theme(text = element_text(size=rel(3)))

p4 = mod_seed_Vr_no_apis_trial.2$plots[[4]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus libanotis"), aes(x =  No_Apis_visit_rate, y = Seeds),shape=20)+ labs(x = "No_Apis_visit_rate", y ="seed_number",subtitle = "C.libanotis")+ theme_classic()+theme(text = element_text(size=rel(3)))

p5 = mod_seed_Vr_no_apis_trial.2$plots[[5]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus monspeliensis"), aes(x =  No_Apis_visit_rate, y = Seeds),shape=20)+ labs(x = "No_Apis_visit_rate", y = "seed_number", subtitle = "C.monspeliensis")+theme_classic()+theme(text = element_text(size=rel(3)))

p6 = mod_seed_Vr_no_apis_trial.2$plots[[6]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus salviifolius"), aes(x =  No_Apis_visit_rate, y = Seeds),shape=20)+ labs(x = "No_Apis_visit_rate", y = "seed_number",subtitle = "C.salviifolius")+ theme_classic()+theme(text = element_text(size=rel(3)))

p7 = mod_seed_Vr_no_apis_trial.2$plots[[7]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium calycinum"), aes(x =  No_Apis_visit_rate, y = Seeds),shape=20) + labs(x = "No_Apis_visit_rate", y = "seed_number",subtitle = "H.calycinum") + theme_classic()+theme(text = element_text(size=rel(3)))

p8 = mod_seed_Vr_no_apis_trial.2$plots[[8]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium halimifolium"), aes(x =  No_Apis_visit_rate, y = Seeds),shape=20) + labs(x = "No_Apis_visit_rate", y = "seed_number",subtitle = "H.halimifolium")+ theme_classic()+theme(text = element_text(size=rel(3)))

p9 = mod_seed_Vr_no_apis_trial.2$plots[[9]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula pedunculata"), aes(x =  No_Apis_visit_rate, y = Seeds),shape=20)+ labs(x = "No_Apis_visit_rate",y = "seed_number",subtitle = "L.pedunculata")+  theme_classic()+theme(text = element_text(size=rel(3)))

p10 = mod_seed_Vr_no_apis_trial.2$plots[[10]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula stoechas"), aes(x =  No_Apis_visit_rate, y = Seeds),shape=20)+ labs(x = "No_Apis_visit_rate",y = "seed_number",subtitle = "L.stoechas")+  theme_classic()+theme(text = element_text(size=rel(3)))

p11 = mod_seed_Vr_no_apis_trial.2$plots[[11]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Salvia rosmarinus"), aes(x =  No_Apis_visit_rate, y = Seeds),shape=20)+ labs(x = "No_Apis_visit_rate",y = "seed_number",subtitle = "S.rosmarinus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p12 = mod_seed_Vr_no_apis_trial.2$plots[[12]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Teucrium fruticans"), aes(x =  No_Apis_visit_rate, y = Seeds),shape=20)+ labs(x = "No_Apis_visit_rate",y = "seed_number",subtitle = "T.fruticans")+  theme_classic()+theme(text = element_text(size=rel(3)))

p1+p2+p3+p4+p5+p6+p7+p8+p9+p10+p11+p12

```

\newpage


\newpage

## Visitation rate of Apis mellifera 

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%"}

mod_seed_Vr_apis<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seeds~Apis_visit_rate+(1|Site_ID),data))) %>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()


opts <- options(knitr.kable.NA = "")

mod_seed_Vr_apis<-mod_seed_Vr_apis %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
mod_seed_Vr_apis<-filter(mod_seed_Vr_apis, !term == "sd__(Intercept)" & !term =="sd__Observation")


mod_seed_Vr_apis %>% 
kable("latex", booktabs = TRUE,digits =  4, linesep = c("","\\addlinespace")) %>% column_spec(7, bold = ifelse(mod_seed_Vr_apis$p.value < 0.05, T, F) )%>%
  kable_styling(position="center", latex_option="hold_position")

```

```{r,echo=FALSE, warning=FALSE,message=FALSE, out.width="80%"}

mod_seed_Vr_apis_glance<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seeds~Apis_visit_rate+(1|Site_ID),data))) %>%
  summarize(glance(model))%>%
  ungroup()

mod_seed_Vr_apis_glance %>% 
 kable("latex",booktabs = TRUE, digits =  3,linesep = "",align = "lccccccc")%>%
  kable_styling(font_size = 8,full_width = F, position="center")
```


```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%", fig.align='center'}

# model plot 
mod_seed_Vr_apis_trial.2 <- Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seeds~Apis_visit_rate+(1|Site_ID),data))) %>%
  mutate(model1 = list(ggeffects::ggpredict(model, terms = "Apis_visit_rate"))) %>%
  mutate(plots = list(ggplot(model1, aes(x, predicted)) + geom_line() +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = .2)))


p1 = mod_seed_Vr_apis_trial.2$plots[[1]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Asphodelus fistulosus"), aes(x =  Apis_visit_rate, y = Seeds),shape=20)+ labs(x = "Apis_visit_rate",y="seed_number",subtitle = "A.fistulosus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p2 = mod_seed_Vr_apis_trial.2$plots[[2]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus crispus"), aes(x =  Apis_visit_rate, y = Seeds),shape=20)+  labs(x = "Apis_visit_rate",y="seed_number",subtitle = "C.crispus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p3 = mod_seed_Vr_apis_trial.2$plots[[3]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus ladanifer"), aes(x =  Apis_visit_rate, y = Seeds),shape=20)+ labs(x = "Apis_visit_rate",y="seed_number",subtitle = "C.ladanifer")+  theme_classic()+theme(text = element_text(size=rel(3)))

p4 = mod_seed_Vr_apis_trial.2$plots[[4]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus libanotis"), aes(x =  Apis_visit_rate, y = Seeds),shape=20)+labs(x = "Apis_visit_rate",y="seed_number",subtitle = "C.libanotis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p5 = mod_seed_Vr_apis_trial.2$plots[[5]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus monspeliensis"), aes(x =  Apis_visit_rate, y = Seeds),shape=20)+ labs(x = "Apis_visit_rate",y="seed_number",subtitle = "C.monspeliensis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p6 = mod_seed_Vr_apis_trial.2$plots[[6]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus salviifolius"), aes(x =  Apis_visit_rate, y = Seeds),shape=20)+ labs(x = "Apis_visit_rate",y="seed_number",subtitle = "C.salviifolius")+  theme_classic()+theme(text = element_text(size=rel(3)))

p7 = mod_seed_Vr_apis_trial.2$plots[[7]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium calycinum"), aes(x =  Apis_visit_rate, y = Seeds),shape=20)+ labs(x = "Apis_visit_rate",y="seed_number",subtitle = "H.calycinum")+  theme_classic()+theme(text = element_text(size=rel(3)))

p8 = mod_seed_Vr_apis_trial.2$plots[[8]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium halimifolium"), aes(x =  Apis_visit_rate, y = Seeds),shape=20)+ labs(x = "Apis_visit_rate",y="seed_number",subtitle = "H.halimifolium")+  theme_classic()+theme(text = element_text(size=rel(3)))

p9 = mod_seed_Vr_apis_trial.2$plots[[9]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula pedunculata"), aes(x =  Apis_visit_rate, y = Seeds),shape=20)+ labs(x = "Apis_visit_rate",y="seed_number",subtitle = "L.pedunculata")+  theme_classic()+theme(text = element_text(size=rel(3)))

p10 = mod_seed_Vr_apis_trial.2$plots[[10]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula stoechas"), aes(x =  Apis_visit_rate, y = Seeds),shape=20)+ labs(x = "Apis_visit_rate",y="seed_number",subtitle = "L.stoechas")+  theme_classic()+theme(text = element_text(size=rel(3)))

p11 = mod_seed_Vr_apis_trial.2$plots[[11]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Salvia rosmarinus"), aes(x =  Apis_visit_rate, y = Seeds),shape=20)+ labs(x = "Apis_visit_rate",y="seed_number",subtitle = "S.rosmarinus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p12 = mod_seed_Vr_apis_trial.2$plots[[12]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Teucrium fruticans"), aes(x =  Apis_visit_rate, y = Seeds),shape=20)+ labs(x = "Apis_visit_rate",y="seed_number",subtitle = "T.fruticans")+  theme_classic()+theme(text = element_text(size=rel(3)))

p1+p2+p3+p4+p5+p6+p7+p8+p9+p10+p11+p12

```


## Hymenoptera visitation rate 

```{r,echo=FALSE, warning=FALSE,message=FALSE,fig.height = 13,fig.width=15, out.width="100%"}
#plot
plots_seed_3 <- Pollinator_Plant %>%
  group_by(Plant_gen_sp) %>%
  group_map(~ ggplot(.) + aes(x=Hym_visit, y=Seeds) + 
              geom_point() + ggtitle(.y[[1]]))

ggarrange(plots_seed_3[[1]],plots_seed_3[[2]],plots_seed_3[[3]],plots_seed_3[[4]],plots_seed_3[[5]],plots_seed_3[[6]],plots_seed_3[[7]],plots_seed_3[[8]],plots_seed_3[[9]],plots_seed_3[[10]],plots_seed_3[[11]],plots_seed_3[[12]], ncol=3,nrow=4)

```

\newpage

Summary of models for seed number ~ Hymenoptera visitation per plant species (LMM). Site_ID as factor random

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%"}

# hymenoptera visitation
mod_seed3<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seeds~Hym_visit+(1|Site_ID),data))) %>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()


opts <- options(knitr.kable.NA = "")

mod_seed3<-mod_seed3 %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
mod_seed3<-filter(mod_seed3, !term == "sd__(Intercept)" & !term =="sd__Observation")


mod_seed3 %>% 
kable("latex", booktabs = TRUE,digits =  4, linesep = c("","\\addlinespace")) %>% column_spec(7, bold = ifelse(mod_seed3$p.value < 0.05, T, F) )%>%
  kable_styling(position="center", latex_option="hold_position")

```

```{r,echo=FALSE, warning=FALSE,message=FALSE, out.width="80%"}

mod_seed3_glance<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seeds~Hym_visit+(1|Site_ID),data))) %>%
  summarize(glance(model))%>%
  ungroup()

mod_seed3_glance %>% 
 kable("latex",booktabs = TRUE, digits =  3,linesep = "",align = "lccccccc")%>%
  kable_styling(font_size = 8,full_width = F, position="center")
```

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%", fig.align='center'}

# model plot 
mod_seed.3 <- Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seeds~Hym_visit+(1|Site_ID),data))) %>%
  mutate(model1 = list(ggeffects::ggpredict(model, terms = "Hym_visit"))) %>%
  mutate(plots = list(ggplot(model1, aes(x, predicted)) + geom_line() +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = .2)))



p1=mod_seed.3$plots[[1]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Asphodelus fistulosus"), aes(x =  Hym_visit, y = Seeds),shape=20)+  labs(x = "Hymenoptera_visit",y="seed_number",subtitle = "A.fistulosus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p2=mod_seed.3$plots[[2]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus crispus"), aes(x =  Hym_visit, y = Seeds),shape=20)+ labs(x = "Hymenoptera_visit",y="seed_number",subtitle = "C.crispus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p3=mod_seed.3$plots[[3]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus ladanifer"), aes(x =  Hym_visit, y = Seeds),shape=20)+ labs(x = "Hymenoptera_visit",y="seed_number",subtitle = "C.ladanifer")+  theme_classic()+theme(text = element_text(size=rel(3)))

p4=mod_seed.3$plots[[4]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus libanotis"), aes(x =  Hym_visit, y = Seeds),shape=20)+ labs(x = "Hymenoptera_visit",y="seed_number",subtitle = "C.libanotis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p5=mod_seed.3$plots[[5]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus monspeliensis"), aes(x =  Hym_visit, y = Seeds),shape=20)+ labs(x = "Hymenoptera_visit",y="seed_number",subtitle = "C.monspeliensis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p6=mod_seed.3$plots[[6]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus salviifolius"), aes(x =  Hym_visit, y = Seeds),shape=20)+ labs(x = "Hymenoptera_visit",y="seed_number",subtitle = "C.salviifolius")+  theme_classic()+theme(text = element_text(size=rel(3)))

p7=mod_seed.3$plots[[7]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium calycinum"), aes(x =  Hym_visit, y = Seeds),shape=20)+ labs(x = "Hymenoptera_visit",y="seed_number",subtitle = "H.calycinum")+  theme_classic()+theme(text = element_text(size=rel(3)))

p8=mod_seed.3$plots[[8]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium halimifolium"), aes(x =  Hym_visit, y = Seeds),shape=20)+labs(x = "Hymenoptera_visit",y="seed_number",subtitle = "H.halimifolium")+  theme_classic()+theme(text = element_text(size=rel(3)))

p9=mod_seed.3$plots[[9]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula pedunculata"), aes(x =  Hym_visit, y = Seeds),shape=20)+ labs(x = "Hymenoptera_visit",y="seed_number",subtitle = "L.pedunculata")+  theme_classic()+theme(text = element_text(size=rel(3)))

p10=mod_seed.3$plots[[10]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula stoechas"), aes(x =  Hym_visit, y = Seeds),shape=20)+  labs(x = "Hymenoptera_visit",y="seed_number",subtitle = "L.stoechas")+  theme_classic()+theme(text = element_text(size=rel(3)))

p11=mod_seed.3$plots[[11]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Salvia rosmarinus"), aes(x =  Hym_visit, y = Seeds),shape=20)+ labs(x = "Hymenoptera_visit",y="seed_number",subtitle = "S.rosmarinus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p12=mod_seed.3$plots[[12]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Teucrium fruticans"), aes(x =  Hym_visit, y = Seeds),shape=20)+  labs(x = "Hymenoptera_visit",y="seed_number",subtitle = "T.fruticans")+  theme_classic()+theme(text = element_text(size=rel(3)))

p1+p2+p3+p4+p5+p6+p7+p8+p9+p10+p11+p12

```


\newpage

## Hymenoptera visitation rate without A.mellifera

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%"}

#model
mod_seed_hym_no_apis<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seeds~Hym_visit_sin_apis+(1|Site_ID),data))) %>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()


opts <- options(knitr.kable.NA = "")

mod_seed_hym_no_apis<-mod_seed_hym_no_apis %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
mod_seed_hym_no_apis<-filter(mod_seed_hym_no_apis, !term == "sd__(Intercept)" & !term =="sd__Observation")


mod_seed_hym_no_apis %>% 
kable("latex", booktabs = TRUE,digits =  4, linesep = c("","\\addlinespace")) %>% column_spec(7, bold = ifelse(mod_seed_hym_no_apis$p.value < 0.05, T, F) ) %>%  kable_styling(position="center", latex_option="hold_position")

```

```{r,echo=FALSE, warning=FALSE,message=FALSE, out.width="80%"}

mod_seed_hym_no_apis_glance<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seeds~Hym_visit_sin_apis+(1|Site_ID),data))) %>%
  summarize(glance(model))%>%
  ungroup()

mod_seed_hym_no_apis_glance %>% 
 kable("latex",booktabs = TRUE, digits =  3,linesep = "",align = "lccccccc")%>%  kable_styling(font_size = 8,full_width = F, position="center")
```

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%", fig.align='center'}

# model plot 
mod_seedhym_no_apis.2 <- Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seeds~Hym_visit_sin_apis+(1|Site_ID),data))) %>%
  mutate(model1 = list(ggeffects::ggpredict(model, terms = "Hym_visit_sin_apis"))) %>%
  mutate(plots = list(ggplot(model1, aes(x, predicted)) + geom_line() +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = .2)))


p1 = mod_seedhym_no_apis.2$plots[[1]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Asphodelus fistulosus"), aes(x =  Hym_visit_sin_apis, y = Seeds),shape=20)+ labs(x = "Hym_visit_sin_apis",y="seed_number",subtitle = "A.fistulosus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p2 = mod_seedhym_no_apis.2$plots[[2]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus crispus"), aes(x =  Hym_visit_sin_apis, y = Seeds),shape=20)+ labs(x = "Hym_visit_sin_apis",y="seed_number",subtitle = "C.crispus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p3 = mod_seedhym_no_apis.2$plots[[3]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus ladanifer"), aes(x =  Hym_visit_sin_apis, y = Seeds),shape=20)+labs(x = "Hym_visit_sin_apis",y="seed_number",subtitle = "C.ladanifer")+  theme_classic()+theme(text = element_text(size=rel(3)))

p4 = mod_seedhym_no_apis.2$plots[[4]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus libanotis"), aes(x =  Hym_visit_sin_apis, y = Seeds),shape=20)+ labs(x = "Hym_visit_sin_apis",y="seed_number",subtitle = "C.libanotis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p5 = mod_seedhym_no_apis.2$plots[[5]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus monspeliensis"), aes(x =  Hym_visit_sin_apis, y = Seeds),shape=20)+ labs(x = "Hym_visit_sin_apis",y="seed_number",subtitle = "C.monspeliensis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p6 = mod_seedhym_no_apis.2$plots[[6]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus salviifolius"), aes(x =  Hym_visit_sin_apis, y = Seeds),shape=20)+ labs(x = "Hym_visit_sin_apis",y="seed_number",subtitle = "C.salviifolius")+  theme_classic()+theme(text = element_text(size=rel(3)))

p7 = mod_seedhym_no_apis.2$plots[[7]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium calycinum"), aes(x =  Hym_visit_sin_apis, y = Seeds),shape=20)+ labs(x = "Hym_visit_sin_apis",y="seed_number",subtitle = "H.calycinum")+  theme_classic()+theme(text = element_text(size=rel(3)))

p8 = mod_seedhym_no_apis.2$plots[[8]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium halimifolium"), aes(x =  Hym_visit_sin_apis, y = Seeds),shape=20)+ labs(x = "Hym_visit_sin_apis",y="seed_number",subtitle = "H.halimifolium")+  theme_classic()+theme(text = element_text(size=rel(3)))

p9 = mod_seedhym_no_apis.2$plots[[9]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula pedunculata"), aes(x =  Hym_visit_sin_apis, y = Seeds),shape=20)+labs(x = "Hym_visit_sin_apis",y="seed_number",subtitle = "L.pedunculata")+  theme_classic()+theme(text = element_text(size=rel(3)))

p10 = mod_seedhym_no_apis.2$plots[[10]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula stoechas"), aes(x =  Hym_visit_sin_apis, y = Seeds),shape=20)+ labs(x = "Hym_visit_sin_apis",y="seed_number",subtitle = "L.stoechas")+  theme_classic()+theme(text = element_text(size=rel(3)))

p11 = mod_seedhym_no_apis.2$plots[[11]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Salvia rosmarinus"), aes(x =  Hym_visit_sin_apis, y = Seeds),shape=20)+labs(x = "Hym_visit_sin_apis",y="seed_number",subtitle = "S.rosmarinus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p12 = mod_seedhym_no_apis.2$plots[[12]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Teucrium fruticans"), aes(x =  Hym_visit_sin_apis, y = Seeds),shape=20)+ labs(x = "Hym_visit_sin_apis",y="seed_number",subtitle = "T.fruticans")+  theme_classic()+theme(text = element_text(size=rel(3)))


p1+p2+p3+p4+p5+p6+p7+p8+p9+p10+p11+p12

```


\newpage 

## Pollinator frequency

```{r,echo=FALSE, warning=FALSE,message=FALSE,fig.height = 13,fig.width=15, out.width="100%"}
#plot
plots_seed_4 <- Pollinator_Plant %>%
  group_by(Plant_gen_sp) %>%
  group_map(~ ggplot(.) + aes(x=Frequency, y=Seeds) + 
              geom_point() + ggtitle(.y[[1]]))

ggarrange(plots_seed_4[[1]],plots_seed_4[[2]],plots_seed_4[[3]],plots_seed_4[[4]],plots_seed_4[[5]],plots_seed_4[[6]],plots_seed_4[[7]],plots_seed_4[[8]],plots_seed_4[[9]],plots_seed_4[[10]],plots_seed_4[[11]],plots_seed_4[[12]], ncol=3,nrow=4)

```

\newpage

Summary of models for seed number ~ pollinator frequency per plant species (LMM). Site_ID as factor random

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%"}

# Frequency
mod_seed4<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seeds~Frequency+(1|Site_ID),data))) %>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()

opts <- options(knitr.kable.NA = "")

mod_seed4<-mod_seed4 %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
mod_seed4<-filter(mod_seed4, !term == "sd__(Intercept)" & !term =="sd__Observation")


mod_seed4 %>% 
kable("latex", booktabs = TRUE,digits =  4, linesep = c("","\\addlinespace")) %>% column_spec(7, bold = ifelse(mod_seed4$p.value < 0.05, T, F) )%>%
  kable_styling(position="center", latex_option="hold_position")

```

```{r,echo=FALSE, warning=FALSE,message=FALSE, out.width="80%"}

mod_seed4_glance<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seeds~Frequency+(1|Site_ID),data))) %>%
  summarize(glance(model))%>%
  ungroup()

mod_seed4_glance %>% 
 kable("latex",booktabs = TRUE, digits =  3,linesep = "",align = "lccccccc")%>%
  kable_styling(font_size = 8,full_width = F, position="center")
```

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%", fig.align='center'}

mod_seed.4 <- Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seeds~Frequency+(1|Site_ID),data))) %>%
  mutate(model1 = list(ggeffects::ggpredict(model, terms = "Frequency"))) %>%
  mutate(plots = list(ggplot(model1, aes(x, predicted)) + geom_line() +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = .2)))


p1=mod_seed.4$plots[[1]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Asphodelus fistulosus"), aes(x =  Frequency, y = Seeds),shape=20)+ labs(x = "Frequency",y="seed_number",subtitle = "A.fistulosus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p2=mod_seed.4$plots[[2]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus crispus"), aes(x =  Frequency, y = Seeds),shape=20)+labs(x = "Frequency",y="seed_number",subtitle = "C.crispus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p3=mod_seed.4$plots[[3]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus ladanifer"), aes(x =  Frequency, y = Seeds),shape=20)+labs(x = "Frequency",y="seed_number",subtitle = "C.ladanifer")+  theme_classic()+theme(text = element_text(size=rel(3)))

p4=mod_seed.4$plots[[4]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus libanotis"), aes(x =  Frequency, y = Seeds),shape=20)+ labs(x = "Frequency",y="seed_number",subtitle = "C.libanotis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p5=mod_seed.4$plots[[5]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus monspeliensis"), aes(x =  Frequency, y = Seeds),shape=20)+ labs(x = "Frequency",y="seed_number",subtitle = "C.monspeliensis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p6=mod_seed.4$plots[[6]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus salviifolius"), aes(x =  Frequency, y = Seeds),shape=20)+ labs(x = "Frequency",y="seed_number",subtitle = "C.salviifolius")+  theme_classic()+theme(text = element_text(size=rel(3)))

p7=mod_seed.4$plots[[7]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium calycinum"), aes(x =  Frequency, y = Seeds),shape=20)+ labs(x = "Frequency",y="seed_number",subtitle = "H.calycinum")+  theme_classic()+theme(text = element_text(size=rel(3)))

p8=mod_seed.4$plots[[8]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium halimifolium"), aes(x =  Frequency, y = Seeds),shape=20)+ labs(x = "Frequency",y="seed_number",subtitle = "H.halimifolium")+  theme_classic()+theme(text = element_text(size=rel(3)))

p9=mod_seed.4$plots[[9]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula pedunculata"), aes(x =  Frequency, y = Seeds),shape=20)+ labs(x = "Frequency",y="seed_number",subtitle = "L.pedunculata")+  theme_classic()+theme(text = element_text(size=rel(3)))

p10=mod_seed.4$plots[[10]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula stoechas"), aes(x =  Frequency, y = Seeds),shape=20)+ labs(x = "Frequency",y="seed_number",subtitle = "L.stoechas")+  theme_classic()+theme(text = element_text(size=rel(3)))

p11=mod_seed.4$plots[[11]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Salvia rosmarinus"), aes(x =  Frequency, y = Seeds),shape=20)+ labs(x = "Frequency",y="seed_number",subtitle = "S.rosmarinus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p12=mod_seed.4$plots[[12]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Teucrium fruticans"), aes(x =  Frequency, y = Seeds),shape=20)+ labs(x = "Frequency",y="seed_number",subtitle = "T.fruticans")+  theme_classic()+theme(text = element_text(size=rel(3)))


p1+p2+p3+p4+p5+p6+p7+p8+p9+p10+p11+p12

```


\newpage




# Seed weight

seed weight mean per fruit in plant individual per plant species

## Richness

```{r,echo=FALSE, warning=FALSE,message=FALSE,fig.height = 13,fig.width=15, out.width="100%"}
#plot
plots_seed_weight <- Pollinator_Plant %>%
  group_by(Plant_gen_sp) %>%
  group_map(~ ggplot(.) + aes(x=richness, y=Seed_weight) + 
              geom_point() + ggtitle(.y[[1]]))

ggarrange(plots_seed_weight[[1]],plots_seed_weight[[2]],plots_seed_weight[[3]],plots_seed_weight[[4]],plots_seed_weight[[5]],plots_seed_weight[[6]],plots_seed_weight[[7]],plots_seed_weight[[8]],plots_seed_weight[[9]],plots_seed_weight[[10]],plots_seed_weight[[11]],plots_seed_weight[[12]], ncol=3,nrow=4)

```

\newpage

Summary of models for seed weight ~ richness per plant species (LMM). Site_ID as factor random
```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%"}

#Models _ Seed weight 
# richnes
mod_seed_weight<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seed_weight~richness+(1|Site_ID),data))) %>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()

opts <- options(knitr.kable.NA = "")

mod_seed_weight<-mod_seed_weight %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
mod_seed_weight<-filter(mod_seed_weight, !term == "sd__(Intercept)" & !term =="sd__Observation")

mod_seed_weight %>% 
kable("latex",booktabs = TRUE,digits =  4, linesep = c("","\\addlinespace")) %>% 
column_spec(7, bold = ifelse(mod_seed_weight$p.value < 0.05, T, F) )%>%
  kable_styling(position="center", latex_option="hold_position")

```

```{r,echo=FALSE, warning=FALSE,message=FALSE, out.width="80%"}

mod_seed_weight_glance<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seed_weight~richness+(1|Site_ID),data))) %>%
  summarize(glance(model))%>%
  ungroup()

mod_seed_weight_glance %>% 
 kable("latex",booktabs = TRUE, digits =  3,linesep = "",align = "lccccccc")%>%
  kable_styling(font_size = 8,full_width = F, position="center")
```

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%", fig.align='center'}

mod_seed_weight.1 <- Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seed_weight~richness+(1|Site_ID),data))) %>%
  mutate(model1 = list(ggeffects::ggpredict(model, terms = "richness"))) %>%
  mutate(plots = list(ggplot(model1, aes(x, predicted)) + geom_line() +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = .2)))



p1=mod_seed_weight.1$plots[[1]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Asphodelus fistulosus"), aes(x =  richness, y = Seed_weight),shape=20)+ labs(x = "richness",y="Seed_weight",subtitle = "A.fistulosus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p2= mod_seed_weight.1$plots[[2]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus crispus"), aes(x =  richness, y = Seed_weight),shape=20)+ labs(x = "richness",y="Seed_weight",subtitle = "C.crispus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p3=mod_seed_weight.1$plots[[3]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus ladanifer"), aes(x =  richness, y = Seed_weight),shape=20)+ labs(x = "richness",y="Seed_weight",subtitle = "C.ladanifer")+  theme_classic()+theme(text = element_text(size=rel(3)))

p4=mod_seed_weight.1$plots[[4]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus libanotis"), aes(x =  richness, y = Seed_weight),shape=20)+ labs(x = "richness",y="Seed_weight",subtitle = "C.libanotis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p5=mod_seed_weight.1$plots[[5]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus monspeliensis"), aes(x =  richness, y = Seed_weight),shape=20)+labs(x = "richness",y="Seed_weight",subtitle = "C.monspeliensis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p6=mod_seed_weight.1$plots[[6]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus salviifolius"), aes(x =  richness, y = Seed_weight),shape=20)+ labs(x = "richness",y="Seed_weight",subtitle = "C.salviifolius")+  theme_classic()+theme(text = element_text(size=rel(3)))

p7=mod_seed_weight.1$plots[[7]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium calycinum"), aes(x =  richness, y = Seed_weight),shape=20)+ labs(x = "richness",y="Seed_weight",subtitle = "H.calycinum")+  theme_classic()+theme(text = element_text(size=rel(3)))

p8=mod_seed_weight.1$plots[[8]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium halimifolium"), aes(x =  richness, y = Seed_weight),shape=20)+ labs(x = "richness",y="Seed_weight",subtitle = "H.halimifolium")+  theme_classic()+theme(text = element_text(size=rel(3)))

p9=mod_seed_weight.1$plots[[9]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula pedunculata"), aes(x =  richness, y = Seed_weight),shape=20)+ labs(x = "richness",y="Seed_weight",subtitle = "L.pedunculata")+  theme_classic()+theme(text = element_text(size=rel(3)))

p10=mod_seed_weight.1$plots[[10]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula stoechas"), aes(x =  richness, y = Seed_weight),shape=20)+ labs(x = "richness",y="Seed_weight",subtitle = "L.stoechas")+  theme_classic()+theme(text = element_text(size=rel(3)))

p11=mod_seed_weight.1$plots[[11]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Salvia rosmarinus"), aes(x =  richness, y = Seed_weight),shape=20)+ labs(x = "richness",y="Seed_weight",subtitle = "S.rosmarinus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p12=mod_seed_weight.1$plots[[12]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Teucrium fruticans"), aes(x =  richness, y = Seed_weight),shape=20)+  labs(x = "richness",y="Seed_weight",subtitle = "T.fruticans")+  theme_classic()+theme(text = element_text(size=rel(3)))

p1+p2+p3+p4+p5+p6+p7+p8+p9+p10+p11+p12

```


\newpage

## Visitation rate

```{r,echo=FALSE, warning=FALSE,message=FALSE,fig.height = 13,fig.width=15, out.width="100%"}
#plot
plots_seed_weight2 <- Pollinator_Plant %>%
  group_by(Plant_gen_sp) %>%
  group_map(~ ggplot(.) + aes(x=visitatio_rate, y=Seed_weight) + 
              geom_point() + ggtitle(.y[[1]]))

ggarrange(plots_seed_weight2[[1]],plots_seed_weight2[[2]],plots_seed_weight2[[3]],plots_seed_weight2[[4]],plots_seed_weight2[[5]],plots_seed_weight2[[6]],plots_seed_weight2[[7]],plots_seed_weight2[[8]],plots_seed_weight2[[9]],plots_seed_weight2[[10]],plots_seed_weight2[[11]],plots_seed_weight2[[12]], ncol=3,nrow=4)

```


\newpage

Summary of models for seed weight ~ visitation rate per plant species (LMM). Site_ID as factor random

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%"}

#Models _ Seed weight 
# visistation rate
mod_seed_weight2<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seed_weight~visitatio_rate+(1|Site_ID),data))) %>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()

opts <- options(knitr.kable.NA = "")

mod_seed_weight2<-mod_seed_weight2 %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
mod_seed_weight2<-filter(mod_seed_weight2, !term == "sd__(Intercept)" & !term =="sd__Observation")

mod_seed_weight2 %>% 
kable("latex", booktabs = TRUE,digits =  4, linesep = c("","\\addlinespace")) %>% column_spec(7, bold = ifelse(mod_seed_weight2$p.value < 0.05, T, F) )%>%
  kable_styling(position="center", latex_option="hold_position")

```

```{r,echo=FALSE, warning=FALSE,message=FALSE, out.width="80%"}

mod_seed_weight2_glance<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seed_weight~visitatio_rate+(1|Site_ID),data))) %>%
  summarize(glance(model))%>%
  ungroup()

mod_seed_weight2_glance %>% 
 kable("latex",booktabs = TRUE, digits =  3,linesep = "",align = "lccccccc")%>%
  kable_styling(font_size = 8,full_width = F, position="center")
```

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%", fig.align='center'}

mod_seed_weight.2 <- Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seed_weight~visitatio_rate+(1|Site_ID),data))) %>%
  mutate(model1 = list(ggeffects::ggpredict(model, terms = "visitatio_rate"))) %>%
  mutate(plots = list(ggplot(model1, aes(x, predicted)) + geom_line() +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = .2)))



p1=mod_seed_weight.2$plots[[1]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Asphodelus fistulosus"), aes(x =  visitatio_rate, y = Seed_weight),shape=20)+ labs(x = "visitation_rate",y="Seed_weight",subtitle = "A.fistulosus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p2=mod_seed_weight.2$plots[[2]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus crispus"), aes(x =  visitatio_rate, y = Seed_weight),shape=20)+ labs(x = "visitation_rate",y="Seed_weight",subtitle = "C.crispus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p3=mod_seed_weight.2$plots[[3]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus ladanifer"), aes(x =  visitatio_rate, y = Seed_weight),shape=20)+ labs(x = "visitation_rate",y="Seed_weight",subtitle = "C.ladanifer")+  theme_classic()+theme(text = element_text(size=rel(3)))

p4=mod_seed_weight.2$plots[[4]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus libanotis"), aes(x =  visitatio_rate, y = Seed_weight),shape=20)+ labs(x = "visitation_rate",y="Seed_weight",subtitle = "C.libanotis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p5=mod_seed_weight.2$plots[[5]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus monspeliensis"), aes(x =  visitatio_rate, y = Seed_weight),shape=20)+ labs(x = "visitation_rate",y="Seed_weight",subtitle = "C.monspeliensis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p6=mod_seed_weight.2$plots[[6]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus salviifolius"), aes(x =  visitatio_rate, y = Seed_weight),shape=20)+ labs(x = "visitation_rate",y="Seed_weight",subtitle = "C.salviifolius")+  theme_classic()+theme(text = element_text(size=rel(3)))

p7=mod_seed_weight.2$plots[[7]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium calycinum"), aes(x =  visitatio_rate, y = Seed_weight),shape=20)+ labs(x = "visitation_rate",y="Seed_weight",subtitle = "H.calycinum")+  theme_classic()+theme(text = element_text(size=rel(3)))

p8=mod_seed_weight.2$plots[[8]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium halimifolium"), aes(x =  visitatio_rate, y = Seed_weight),shape=20)+labs(x = "visitation_rate",y="Seed_weight",subtitle = "H.halimifolium")+  theme_classic()+theme(text = element_text(size=rel(3)))

p9=mod_seed_weight.2$plots[[9]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula pedunculata"), aes(x =  visitatio_rate, y = Seed_weight),shape=20)+ labs(x = "visitation_rate",y="Seed_weight",subtitle = "L.pedunculata")+  theme_classic()+theme(text = element_text(size=rel(3)))

p10=mod_seed_weight.2$plots[[10]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula stoechas"), aes(x =  visitatio_rate, y = Seed_weight),shape=20)+ labs(x = "visitation_rate",y="Seed_weight",subtitle = "L.stoechas")+  theme_classic()+theme(text = element_text(size=rel(3)))

p11=mod_seed_weight.2$plots[[11]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Salvia rosmarinus"), aes(x =  visitatio_rate, y = Seed_weight),shape=20)+ labs(x = "visitation_rate",y="Seed_weight",subtitle = "S.rosmarinus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p12=mod_seed_weight.2$plots[[12]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Teucrium fruticans"), aes(x =  visitatio_rate, y = Seed_weight),shape=20)+ labs(x = "visitation_rate",y="Seed_weight",subtitle = "T.fruticans")+  theme_classic()+theme(text = element_text(size=rel(3)))

p1+p2+p3+p4+p5+p6+p7+p8+p9+p10+p11+p12

```


\newpage


\newpage 
## Visitation rate of pollinator without Apis mellifera

```{r echo=FALSE, message=FALSE, warning=FALSE, out.width="100%"}

mod_seed_weight_VR_no_apis<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seed_weight~No_Apis_visit_rate+(1|Site_ID),data))) %>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()

opts <- options(knitr.kable.NA = "")

mod_seed_weight_VR_no_apis<-mod_seed_weight_VR_no_apis %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
mod_seed_weight_VR_no_apis<-filter(mod_seed_weight_VR_no_apis, !term == "sd__(Intercept)" & !term =="sd__Observation")

mod_seed_weight_VR_no_apis %>% 
kable("latex", booktabs = TRUE,digits =  4, linesep = c("","\\addlinespace")) %>% column_spec(7, bold = ifelse(mod_seed_weight_VR_no_apis$p.value < 0.05, T, F) )%>% kable_styling(position="center", latex_option="hold_position")

```

```{r,echo=FALSE, warning=FALSE,message=FALSE, out.width="80%"}

mod_seed_weight_VR_no_apis_glance<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seed_weight~No_Apis_visit_rate+(1|Site_ID),data))) %>%
  summarize(glance(model))%>%
  ungroup()

mod_seed_weight_VR_no_apis_glance %>% 
 kable("latex",booktabs = TRUE, digits =  3,linesep = "",align = "lccccccc")%>%  kable_styling(font_size = 8,full_width = F, position="center")
```


```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%", fig.align='center'}

mod_seed_weight_VR_no_apis.2 <- Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seed_weight~No_Apis_visit_rate+(1|Site_ID),data))) %>%  mutate(model1 = list(ggeffects::ggpredict(model, terms = "No_Apis_visit_rate"))) %>%
  mutate(plots = list(ggplot(model1, aes(x, predicted)) + geom_line() +
 geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = .2)))


p1 = mod_seed_weight_VR_no_apis.2$plots[[1]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Asphodelus fistulosus"), aes(x =  No_Apis_visit_rate, y = Seed_weight),shape=20)+ labs(x = "No_Apis_visit_rate",y="Seed_weight",subtitle = "A.fistulosus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p2 = mod_seed_weight_VR_no_apis.2$plots[[2]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus crispus"), aes(x =  No_Apis_visit_rate, y = Seed_weight),shape=20)+ 
  labs(x = "No_Apis_visit_rate",y="Seed_weight",subtitle = "C.crispus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p3 = mod_seed_weight_VR_no_apis.2$plots[[3]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus ladanifer"), aes(x =  No_Apis_visit_rate, y = Seed_weight),shape=20)+ 
  labs(x = "No_Apis_visit_rate",y="Seed_weight",subtitle = "C.ladanifer")+  theme_classic()+theme(text = element_text(size=rel(3)))

p4 = mod_seed_weight_VR_no_apis.2$plots[[4]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus libanotis"), aes(x =  No_Apis_visit_rate, y = Seed_weight),shape=20)+ 
  labs(x = "No_Apis_visit_rate",y="Seed_weight",subtitle = "C.libanotis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p5 = mod_seed_weight_VR_no_apis.2$plots[[5]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus monspeliensis"), aes(x =  No_Apis_visit_rate, y = Seed_weight),shape=20)+ 
  labs(x = "No_Apis_visit_rate",y="Seed_weight",subtitle = "C.monspeliensis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p6 = mod_seed_weight_VR_no_apis.2$plots[[6]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus salviifolius"), aes(x =  No_Apis_visit_rate, y = Seed_weight),shape=20)+ 
  labs(x = "No_Apis_visit_rate",y="Seed_weight",subtitle = "C.salviifolius")+  theme_classic()+theme(text = element_text(size=rel(3)))

p7 = mod_seed_weight_VR_no_apis.2$plots[[7]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium calycinum"), aes(x =  No_Apis_visit_rate, y = Seed_weight),shape=20)+ 
  labs(x = "No_Apis_visit_rate",y="Seed_weight",subtitle = "H.calycinum")+  theme_classic()+theme(text = element_text(size=rel(3)))

p8 = mod_seed_weight_VR_no_apis.2$plots[[8]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium halimifolium"), aes(x =  No_Apis_visit_rate, y = Seed_weight),shape=20)+ 
  labs(x = "No_Apis_visit_rate",y="Seed_weight",subtitle = "H.halimifolium")+  theme_classic()+theme(text = element_text(size=rel(3)))

p9 = mod_seed_weight_VR_no_apis.2$plots[[9]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula pedunculata"), aes(x =  No_Apis_visit_rate, y = Seed_weight),shape=20)+ 
  labs(x = "No_Apis_visit_rate",y="Seed_weight",subtitle = "L.pedunculata")+  theme_classic()+theme(text = element_text(size=rel(3)))

p10 = mod_seed_weight_VR_no_apis.2$plots[[10]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula stoechas"), aes(x =  No_Apis_visit_rate, y = Seed_weight),shape=20)+ 
  labs(x = "No_Apis_visit_rate",y="Seed_weight",subtitle = "L.stoechas")+  theme_classic()+theme(text = element_text(size=rel(3)))

p11 = mod_seed_weight_VR_no_apis.2$plots[[11]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Salvia rosmarinus"), aes(x =  No_Apis_visit_rate, y = Seed_weight),shape=20)+ 
  labs(x = "No_Apis_visit_rate",y="Seed_weight",subtitle = "S.rosmarinus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p12 = mod_seed_weight_VR_no_apis.2$plots[[12]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Teucrium fruticans"), aes(x =  No_Apis_visit_rate, y = Seed_weight),shape=20)+ 
  labs(x = "No_Apis_visit_rate",y="Seed_weight",subtitle = "T.fruticans")+  theme_classic()+theme(text = element_text(size=rel(3)))


p1+p2+p3+p4+p5+p6+p7+p8+p9+p10+p11+p12

```

\newpage
## Visitation rate of Apis mellifera

```{r echo=FALSE, message=FALSE, warning=FALSE, out.width="100%"}

#model
mod_seed_weight_apis<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seed_weight~Apis_visit_rate+(1|Site_ID),data))) %>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()

opts <- options(knitr.kable.NA = "")

mod_seed_weight_apis<-mod_seed_weight_apis %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
mod_seed_weight_apis<-filter(mod_seed_weight_apis, !term == "sd__(Intercept)" & !term =="sd__Observation")

mod_seed_weight_apis %>% 
kable("latex", booktabs = TRUE,digits =  4, linesep = c("","\\addlinespace")) %>% column_spec(7, bold = ifelse(mod_seed_weight_apis$p.value < 0.05, T, F) )%>% kable_styling(position="center", latex_option="hold_position")

```

```{r,echo=FALSE, warning=FALSE,message=FALSE, out.width="80%"}

mod_seed_weight_apis_glance<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seed_weight~Apis_visit_rate+(1|Site_ID),data))) %>%
  summarize(glance(model))%>%
  ungroup()

mod_seed_weight_apis_glance %>% 
 kable("latex",booktabs = TRUE, digits =  3,linesep = "",align = "lccccccc")%>%  kable_styling(font_size = 8,full_width = F, position="center")
```

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%", fig.align='center'}

mod_seed_weight_apis.2 <- Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seed_weight~Apis_visit_rate+(1|Site_ID),data))) %>%
  mutate(model1 = list(ggeffects::ggpredict(model, terms = "Apis_visit_rate"))) %>%
  mutate(plots = list(ggplot(model1, aes(x, predicted)) + geom_line() +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = .2)))

p1 = mod_seed_weight_apis.2$plots[[1]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Asphodelus fistulosus"), aes(x =  Apis_visit_rate, y = Seed_weight),shape=20)+labs(x = "Apis_visit_rate",y="Seed_weight",subtitle = "A.fistulosus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p2 = mod_seed_weight_apis.2$plots[[2]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus crispus"), aes(x =  Apis_visit_rate, y = Seed_weight),shape=20)+ labs(x = "Apis_visit_rate",y="Seed_weight",subtitle = "C.crispus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p3 = mod_seed_weight_apis.2$plots[[3]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus ladanifer"), aes(x =  Apis_visit_rate, y = Seed_weight),shape=20)+labs(x = "Apis_visit_rate",y="Seed_weight",subtitle = "C.ladanifer")+  theme_classic()+theme(text = element_text(size=rel(3)))

p4 = mod_seed_weight_apis.2$plots[[4]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus libanotis"), aes(x =  Apis_visit_rate, y = Seed_weight),shape=20)+ labs(x = "Apis_visit_rate",y="Seed_weight",subtitle = "C.libanotis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p5 = mod_seed_weight_apis.2$plots[[5]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus monspeliensis"), aes(x =  Apis_visit_rate, y = Seed_weight),shape=20)+labs(x = "Apis_visit_rate",y="Seed_weight",subtitle = "C.monspeliensis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p6 = mod_seed_weight_apis.2$plots[[6]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus salviifolius"), aes(x =  Apis_visit_rate, y = Seed_weight),shape=20)+labs(x = "Apis_visit_rate",y="Seed_weight",subtitle = "C.salviifolius")+  theme_classic()+theme(text = element_text(size=rel(3)))

p7 = mod_seed_weight_apis.2$plots[[7]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium calycinum"), aes(x =  Apis_visit_rate, y = Seed_weight),shape=20)+ labs(x = "Apis_visit_rate",y="Seed_weight",subtitle = "H.calycinum")+  theme_classic()+theme(text = element_text(size=rel(3)))

p8 = mod_seed_weight_apis.2$plots[[8]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium halimifolium"), aes(x =  Apis_visit_rate, y = Seed_weight),shape=20)+labs(x = "Apis_visit_rate",y="Seed_weight",subtitle = "H.halimifolium")+  theme_classic()+theme(text = element_text(size=rel(3)))

p9 = mod_seed_weight_apis.2$plots[[9]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula pedunculata"), aes(x =  Apis_visit_rate, y = Seed_weight),shape=20)+labs(x = "Apis_visit_rate",y="Seed_weight",subtitle = "L.pedunculata")+  theme_classic()+theme(text = element_text(size=rel(3)))

p10 = mod_seed_weight_apis.2$plots[[10]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula stoechas"), aes(x =  Apis_visit_rate, y = Seed_weight),shape=20)+ labs(x = "Apis_visit_rate",y="Seed_weight",subtitle = "L.stoechas")+  theme_classic()+theme(text = element_text(size=rel(3)))

p11 = mod_seed_weight_apis.2$plots[[11]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Salvia rosmarinus"), aes(x =  Apis_visit_rate, y = Seed_weight),shape=20)+ labs(x = "Apis_visit_rate",y="Seed_weight",subtitle = "S.rosmarinus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p12 = mod_seed_weight_apis.2$plots[[12]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Teucrium fruticans"), aes(x =  Apis_visit_rate, y = Seed_weight),shape=20)+ labs(x = "Apis_visit_rate",y="Seed_weight",subtitle = "T.fruticans")+  theme_classic()+theme(text = element_text(size=rel(3)))


p1+p2+p3+p4+p5+p6+p7+p8+p9+p10+p11+p12

```


## Hymenoptera visitation rate

```{r,echo=FALSE, warning=FALSE,message=FALSE,fig.height = 13,fig.width=15, out.width="100%"}
#plot
plots_seed_weight3 <- Pollinator_Plant %>%
  group_by(Plant_gen_sp) %>%
  group_map(~ ggplot(.) + aes(x=Hym_visit, y=Seed_weight) + 
              geom_point() + ggtitle(.y[[1]]))

ggarrange(plots_seed_weight3[[1]],plots_seed_weight3[[2]],plots_seed_weight3[[3]],plots_seed_weight3[[4]],plots_seed_weight3[[5]],plots_seed_weight3[[6]],plots_seed_weight3[[7]],plots_seed_weight3[[8]],plots_seed_weight3[[9]],plots_seed_weight3[[10]],plots_seed_weight3[[11]],plots_seed_weight3[[12]], ncol=3,nrow=4)

```


\newpage

Summary of models for seed weight ~ hymenoptera visitation per plant species (LMM). Site_ID as factor random
```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%"}

#Models _ Seed weight 
# Hymenoptera visitation
mod_seed_weight3<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seed_weight~Hym_visit+(1|Site_ID),data))) %>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()

opts <- options(knitr.kable.NA = "")

mod_seed_weight3<-mod_seed_weight3 %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
mod_seed_weight3<-filter(mod_seed_weight3, !term == "sd__(Intercept)" & !term =="sd__Observation")

mod_seed_weight3 %>% 
kable("latex", booktabs = TRUE,digits =  4, linesep = c("","\\addlinespace")) %>% column_spec(7, bold = ifelse(mod_seed_weight3$p.value < 0.05, T, F) )%>%
  kable_styling(position="center", latex_option="hold_position")

```

```{r,echo=FALSE, warning=FALSE,message=FALSE, out.width="80%"}

mod_seed_weight3_glance<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seed_weight~Hym_visit+(1|Site_ID),data))) %>%
  summarize(glance(model))%>%
  ungroup()

mod_seed_weight3_glance %>% 
 kable("latex",booktabs = TRUE, digits =  3,linesep = "",align = "lccccccc")%>%
  kable_styling(font_size = 8,full_width = F, position="center")
```

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%", fig.align='center'}

mod_seed_weight.3 <- Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seed_weight~Hym_visit+(1|Site_ID),data))) %>%
  mutate(model1 = list(ggeffects::ggpredict(model, terms = "Hym_visit"))) %>%
  mutate(plots = list(ggplot(model1, aes(x, predicted)) + geom_line() +
   geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = .2)))


p1=mod_seed_weight.3$plots[[1]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Asphodelus fistulosus"), aes(x =  Hym_visit, y = Seed_weight),shape=20)+ labs(x = "Hymenoptera_visit",y="Seed_weight",subtitle = "A.fistulosus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p2=mod_seed_weight.3$plots[[2]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus crispus"), aes(x =  Hym_visit, y = Seed_weight),shape=20)+ labs(x = "Hymenoptera_visit",y="Seed_weight",subtitle = "C.crispus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p3=mod_seed_weight.3$plots[[3]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus ladanifer"), aes(x =  Hym_visit, y = Seed_weight),shape=20)+ labs(x = "Hymenoptera_visit",y="Seed_weight",subtitle = "C.ladanifer")+  theme_classic()+theme(text = element_text(size=rel(3)))

p4=mod_seed_weight.3$plots[[4]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus libanotis"), aes(x =  Hym_visit, y = Seed_weight),shape=20)+ labs(x = "Hymenoptera_visit",y="Seed_weight",subtitle = "C.libanotis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p5=mod_seed_weight.3$plots[[5]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus monspeliensis"), aes(x =  Hym_visit, y = Seed_weight),shape=20)+ labs(x = "Hymenoptera_visit",y="Seed_weight",subtitle = "C.monspeliensis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p6=mod_seed_weight.3$plots[[6]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus salviifolius"), aes(x =  Hym_visit, y = Seed_weight),shape=20)+labs(x = "Hymenoptera_visit",y="Seed_weight",subtitle = "C.salviifolius")+  theme_classic()+theme(text = element_text(size=rel(3)))

p7=mod_seed_weight.3$plots[[7]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium calycinum"), aes(x =  Hym_visit, y = Seed_weight),shape=20)+ labs(x = "Hymenoptera_visit",y="Seed_weight",subtitle = "H.calycinum")+  theme_classic()+theme(text = element_text(size=rel(3)))

p8=mod_seed_weight.3$plots[[8]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium halimifolium"), aes(x =  Hym_visit, y = Seed_weight),shape=20)+ labs(x = "Hymenoptera_visit",y="Seed_weight",subtitle = "H.halimifolium")+  theme_classic()+theme(text = element_text(size=rel(3)))

p9=mod_seed_weight.3$plots[[9]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula pedunculata"), aes(x =  Hym_visit, y = Seed_weight),shape=20)+ labs(x = "Hymenoptera_visit",y="Seed_weight",subtitle = "L.pedunculata")+  theme_classic()+theme(text = element_text(size=rel(3)))

p10=mod_seed_weight.3$plots[[10]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula stoechas"), aes(x =  Hym_visit, y = Seed_weight),shape=20)+ labs(x = "Hymenoptera_visit",y="Seed_weight",subtitle = "L.stoechas")+  theme_classic()+theme(text = element_text(size=rel(3)))

p11=mod_seed_weight.3$plots[[11]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Salvia rosmarinus"), aes(x =  Hym_visit, y = Seed_weight),shape=20)+ labs(x = "Hymenoptera_visit",y="Seed_weight",subtitle = "S.rosmarinus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p12=mod_seed_weight.3$plots[[12]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Teucrium fruticans"), aes(x =  Hym_visit, y = Seed_weight),shape=20)+ labs(x = "Hymenoptera_visit",y="Seed_weight",subtitle = "T.fruticans")+  theme_classic()+theme(text = element_text(size=rel(3)))

p1+p2+p3+p4+p5+p6+p7+p8+p9+p10+p11+p12

```


\newpage


\newpage
## Hymenoptera visitation rate without A.mellifera

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%"}

#model
mod_seed_weight_hym_no_apis<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seed_weight~Hym_visit_sin_apis+(1|Site_ID),data))) %>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()

opts <- options(knitr.kable.NA = "")

mod_seed_weight_hym_no_apis<-mod_seed_weight_hym_no_apis %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
mod_seed_weight_hym_no_apis<-filter(mod_seed_weight_hym_no_apis, !term == "sd__(Intercept)" & !term =="sd__Observation")

mod_seed_weight_hym_no_apis %>% 
kable("latex", booktabs = TRUE,digits =  4, linesep = c("","\\addlinespace")) %>% column_spec(7, bold = ifelse(mod_seed_weight_hym_no_apis$p.value < 0.05, T, F) )%>%  kable_styling(position="center", latex_option="hold_position")

```


```{r,echo=FALSE, warning=FALSE,message=FALSE, out.width="80%"}

mod_seed_weight_hym_no_apis_glance<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seed_weight~Hym_visit_sin_apis+(1|Site_ID),data))) %>%
  summarize(glance(model))%>%
  ungroup()

mod_seed_weight_hym_no_apis_glance %>% 
 kable("latex",booktabs = TRUE, digits =  3,linesep = "",align = "lccccccc")%>%
  kable_styling(font_size = 8,full_width = F, position="center")
```

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%", fig.align='center'}

# model plot 
mod_seed_weight_hym_no_apis.2 <- Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seed_weight~Hym_visit_sin_apis+(1|Site_ID),data))) %>%
  mutate(model1 = list(ggeffects::ggpredict(model, terms = "Hym_visit_sin_apis"))) %>%
  mutate(plots = list(ggplot(model1, aes(x, predicted)) + geom_line() +
 geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = .2)))



p1 = mod_seed_weight_hym_no_apis.2$plots[[1]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Asphodelus fistulosus"), aes(x =  Hym_visit_sin_apis, y = Seed_weight),shape=20)+ labs(x = "Hym_visit_sin_apis",y="Seed_weight",subtitle = "A.fistulosus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p2 = mod_seed_weight_hym_no_apis.2$plots[[2]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus crispus"), aes(x =  Hym_visit_sin_apis, y = Seed_weight),shape=20)+ 
labs(x = "Hym_visit_sin_apis",y="Seed_weight",subtitle = "C.crispus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p3 = mod_seed_weight_hym_no_apis.2$plots[[3]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus ladanifer"), aes(x =  Hym_visit_sin_apis, y = Seed_weight),shape=20)+ 
labs(x = "Hym_visit_sin_apis",y="Seed_weight",subtitle = "C.ladanifer")+  theme_classic()+theme(text = element_text(size=rel(3)))

p4 = mod_seed_weight_hym_no_apis.2$plots[[4]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus libanotis"), aes(x =  Hym_visit_sin_apis, y = Seed_weight),shape=20)+ 
labs(x = "Hym_visit_sin_apis",y="Seed_weight",subtitle = "C.libanotis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p5 = mod_seed_weight_hym_no_apis.2$plots[[5]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus monspeliensis"), aes(x =  Hym_visit_sin_apis, y = Seed_weight),shape=20)+ 
labs(x = "Hym_visit_sin_apis",y="Seed_weight",subtitle = "C.monspeliensis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p6 = mod_seed_weight_hym_no_apis.2$plots[[6]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus salviifolius"), aes(x =  Hym_visit_sin_apis, y = Seed_weight),shape=20)+ 
labs(x = "Hym_visit_sin_apis",y="Seed_weight",subtitle = "C.salviifolius")+  theme_classic()+theme(text = element_text(size=rel(3)))

p7 = mod_seed_weight_hym_no_apis.2$plots[[7]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium calycinum"), aes(x =  Hym_visit_sin_apis, y = Seed_weight),shape=20)+ 
labs(x = "Hym_visit_sin_apis",y="Seed_weight",subtitle = "H.calycinum")+  theme_classic()+theme(text = element_text(size=rel(3)))

p8 = mod_seed_weight_hym_no_apis.2$plots[[8]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium halimifolium"), aes(x =  Hym_visit_sin_apis, y = Seed_weight),shape=20)+ 
labs(x = "Hym_visit_sin_apis",y="Seed_weight",subtitle = "H.halimifolium")+  theme_classic()+theme(text = element_text(size=rel(3)))

p9 = mod_seed_weight_hym_no_apis.2$plots[[9]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula pedunculata"), aes(x =  Hym_visit_sin_apis, y = Seed_weight),shape=20)+ 
labs(x = "Hym_visit_sin_apis",y="Seed_weight",subtitle = "L.pedunculata")+  theme_classic()+theme(text = element_text(size=rel(3)))

p10 = mod_seed_weight_hym_no_apis.2$plots[[10]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula stoechas"), aes(x =  Hym_visit_sin_apis, y = Seed_weight),shape=20)+ 
labs(x = "Hym_visit_sin_apis",y="Seed_weight",subtitle = "L.stoechas")+  theme_classic()+theme(text = element_text(size=rel(3)))

p11 = mod_seed_weight_hym_no_apis.2$plots[[11]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Salvia rosmarinus"), aes(x =  Hym_visit_sin_apis, y = Seed_weight),shape=20)+ 
  labs(x = "Hym_visit_sin_apis",y="Seed_weight",subtitle = "S.rosmarinus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p12 = mod_seed_weight_hym_no_apis.2$plots[[12]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Teucrium fruticans"), aes(x =  Hym_visit_sin_apis, y = Seed_weight),shape=20)+ 
labs(x = "Hym_visit_sin_apis",y="Seed_weight",subtitle = "T.fruticans")+  theme_classic()+theme(text = element_text(size=rel(3)))

p1+p2+p3+p4+p5+p6+p7+p8+p9+p10+p11+p12

```


## Frequency

```{r,echo=FALSE, warning=FALSE,message=FALSE,fig.height = 13,fig.width=15, out.width="100%"}
#plot
plots_seed_weight4 <- Pollinator_Plant %>%
  group_by(Plant_gen_sp) %>%
  group_map(~ ggplot(.) + aes(x=Frequency, y=Seed_weight) + 
              geom_point() + ggtitle(.y[[1]]))

ggarrange(plots_seed_weight4[[1]],plots_seed_weight4[[2]],plots_seed_weight4[[3]],plots_seed_weight4[[4]],plots_seed_weight4[[5]],plots_seed_weight4[[6]],plots_seed_weight4[[7]],plots_seed_weight4[[8]],plots_seed_weight4[[9]],plots_seed_weight4[[10]],plots_seed_weight4[[11]],plots_seed_weight4[[12]], ncol=3,nrow=4)

```


\newpage

Summary of models for seed weight ~ pollinator frequency per plant species (LMM). Site_ID as factor random

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%"}

#Models _ Seed weight 
# frequency
mod_seed_weight4<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seed_weight~Frequency+(1|Site_ID),data))) %>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()

opts <- options(knitr.kable.NA = "")

mod_seed_weight4<-mod_seed_weight4 %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
mod_seed_weight4<-filter(mod_seed_weight4, !term == "sd__(Intercept)" & !term =="sd__Observation")

mod_seed_weight4 %>% 
kable("latex", booktabs = TRUE,digits =  4, linesep = c("","\\addlinespace")) %>% column_spec(7, bold = ifelse(mod_seed_weight4$p.value < 0.05, T, F) )%>%
  kable_styling(position="center", latex_option="hold_position")

```

```{r,echo=FALSE, warning=FALSE,message=FALSE, out.width="80%"}

mod_seed_weight4_glance<-Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seed_weight~Frequency+(1|Site_ID),data))) %>%
  summarize(glance(model))%>%
  ungroup()

mod_seed_weight4_glance %>% 
 kable("latex",booktabs = TRUE, digits =  3,linesep = "",align = "lccccccc")%>%
  kable_styling(font_size = 8,full_width = F, position="center")
```


```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%", fig.align='center'}

mod_seed_weight.4 <- Pollinator_Plant %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seed_weight~Frequency+(1|Site_ID),data))) %>%
  mutate(model1 = list(ggeffects::ggpredict(model, terms = "Frequency"))) %>%
  mutate(plots = list(ggplot(model1, aes(x, predicted)) + geom_line() +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = .2)))


p1=mod_seed_weight.4$plots[[1]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Asphodelus fistulosus"), aes(x =  Frequency, y = Seed_weight),shape=20)+ labs(x = "Frequency",y="Seed_weight",subtitle = "A.fistulosus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p2=mod_seed_weight.4$plots[[2]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus crispus"), aes(x =  Frequency, y = Seed_weight),shape=20)+ labs(x = "Frequency",y="Seed_weight",subtitle = "C.crispus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p3=mod_seed_weight.4$plots[[3]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus ladanifer"), aes(x =  Frequency, y = Seed_weight),shape=20)+ labs(x = "Frequency",y="Seed_weight",subtitle = "C.ladanifer")+  theme_classic()+theme(text = element_text(size=rel(3)))

p4=mod_seed_weight.4$plots[[4]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus libanotis"), aes(x =  Frequency, y = Seed_weight),shape=20)+ labs(x = "Frequency",y="Seed_weight",subtitle = "C.libanotis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p5=mod_seed_weight.4$plots[[5]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus monspeliensis"), aes(x =  Frequency, y = Seed_weight),shape=20)+ labs(x = "Frequency",y="Seed_weight",subtitle = "C.monspeliensis")+  theme_classic()+theme(text = element_text(size=rel(3)))

p6=mod_seed_weight.4$plots[[6]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Cistus salviifolius"), aes(x =  Frequency, y = Seed_weight),shape=20)+ labs(x = "Frequency",y="Seed_weight",subtitle = "C.salviifolius")+  theme_classic()+theme(text = element_text(size=rel(3)))

p7=mod_seed_weight.4$plots[[7]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium calycinum"), aes(x =  Frequency, y = Seed_weight),shape=20)+ 
  labs(x = "Frequency",y="Seed_weight",subtitle = "H.calycinum")+  theme_classic()+theme(text = element_text(size=rel(3)))

p8=mod_seed_weight.4$plots[[8]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Halimium halimifolium"), aes(x =  Frequency, y = Seed_weight),shape=20)+ labs(x = "Frequency",y="Seed_weight",subtitle = "H.halimifolium")+  theme_classic()+theme(text = element_text(size=rel(3)))

p9=mod_seed_weight.4$plots[[9]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula pedunculata"), aes(x =  Frequency, y = Seed_weight),shape=20)+ labs(x = "Frequency",y="Seed_weight",subtitle = "L.pedunculata")+  theme_classic()+theme(text = element_text(size=rel(3)))

p10=mod_seed_weight.4$plots[[10]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Lavandula stoechas"), aes(x =  Frequency, y = Seed_weight),shape=20)+ labs(x = "Frequency",y="Seed_weight",subtitle = "L.stoechas")+  theme_classic()+theme(text = element_text(size=rel(3)))

p11=mod_seed_weight.4$plots[[11]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Salvia rosmarinus"), aes(x =  Frequency, y = Seed_weight),shape=20)+ labs(x = "Frequency",y="Seed_weight",subtitle = "S.rosmarinus")+  theme_classic()+theme(text = element_text(size=rel(3)))

p12=mod_seed_weight.4$plots[[12]] + geom_point(data = Pollinator_Plant %>% filter(Plant_gen_sp == "Teucrium fruticans"), aes(x =  Frequency, y = Seed_weight),shape=20)+ labs(x = "Frequency",y="Seed_weight",subtitle = "T.fruticans")+  theme_classic()+theme(text = element_text(size=rel(3)))


p1+p2+p3+p4+p5+p6+p7+p8+p9+p10+p11+p12

```


\newpage


# join together Lavandula species 
(L.peduncalata (49 obs) and L.stoechas (24 obs))

## Fruit proportion - richness

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%"}
Pollinator_Plant<- read.csv("../Data/Pollinator_Plant.csv") 
Pollinator_Plant<-Pollinator_Plant[,-1]

#Species out
spp_out <- Pollinator_Plant %>%
  group_by(Plant_gen_sp) %>%
  summarise(Unique_Id = n_distinct(Site_ID)) %>%
  filter(Unique_Id == 1) %>%
  select(Plant_gen_sp) %>% pull(Plant_gen_sp)


#Data with species in more than 1 site
Pollinator_Plant = Pollinator_Plant %>% filter(!Plant_gen_sp %in% spp_out)

# replace NAs by 0
Pollinator_Plant <- mutate_all(Pollinator_Plant, ~replace(., is.na(.), 0))

lavan_tog=Pollinator_Plant %>%
  mutate(Plant_gen_sp = recode(Plant_gen_sp, "Lavandula pedunculata" = "Lavandula","Lavandula stoechas" = "Lavandula"))

# richnes
ta_f_la<-lavan_tog %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(glmer(cbind(fruit_formado, Fruit_No)~richness + (1|Site_ID),family=binomial,data)))%>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()

opts <- options(knitr.kable.NA = "")

ta_f_la<-ta_f_la %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
ta_f_la<-filter(ta_f_la, !term == "sd__(Intercept)")


ta_f_la %>% 
    kable("latex",booktabs = TRUE,digits =  4, linesep = c("","\\addlinespace")) %>% 
column_spec(6, bold = ifelse(ta_f_la$p.value < 0.05, T, F) )%>%
  kable_styling(position="center", latex_option="hold_position")

```

\newpage

## Fruit proportion - visitation rate

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%"}
Pollinator_Plant<- read.csv("../Data/Pollinator_Plant.csv") 
Pollinator_Plant<-Pollinator_Plant[,-1]

#Species out
spp_out <- Pollinator_Plant %>%
  group_by(Plant_gen_sp) %>%
  summarise(Unique_Id = n_distinct(Site_ID)) %>%
  filter(Unique_Id == 1) %>%
  select(Plant_gen_sp) %>% pull(Plant_gen_sp)


#Data with species in more than 1 site
Pollinator_Plant = Pollinator_Plant %>% filter(!Plant_gen_sp %in% spp_out)

# replace NAs by 0
Pollinator_Plant <- mutate_all(Pollinator_Plant, ~replace(., is.na(.), 0))

lavan_tog=Pollinator_Plant %>%
  mutate(Plant_gen_sp = recode(Plant_gen_sp, "Lavandula pedunculata" = "Lavandula","Lavandula stoechas" = "Lavandula"))

# visistation rate
ta_f2_la<-lavan_tog %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(glmer(cbind(fruit_formado, Fruit_No)~visitatio_rate + (1|Site_ID),family=binomial,data)))%>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()

opts <- options(knitr.kable.NA = "")

ta_f2_la<-ta_f2_la %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
ta_f2_la<-filter(ta_f2_la, !term == "sd__(Intercept)")


ta_f2_la %>% 
    kable("latex",booktabs = TRUE,digits =  4, linesep = c("","\\addlinespace")) %>% 
column_spec(6, bold = ifelse(ta_f2_la$p.value < 0.05, T, F) )%>%
  kable_styling(position="center", latex_option="hold_position")

```

\newpage

## Fruit proportion - hymenoptera visitation

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%"}
Pollinator_Plant<- read.csv("../Data/Pollinator_Plant.csv") 
Pollinator_Plant<-Pollinator_Plant[,-1]

#Species out
spp_out <- Pollinator_Plant %>%
  group_by(Plant_gen_sp) %>%
  summarise(Unique_Id = n_distinct(Site_ID)) %>%
  filter(Unique_Id == 1) %>%
  select(Plant_gen_sp) %>% pull(Plant_gen_sp)


#Data with species in more than 1 site
Pollinator_Plant = Pollinator_Plant %>% filter(!Plant_gen_sp %in% spp_out)

# replace NAs by 0
Pollinator_Plant <- mutate_all(Pollinator_Plant, ~replace(., is.na(.), 0))

lavan_tog=Pollinator_Plant %>%
  mutate(Plant_gen_sp = recode(Plant_gen_sp, "Lavandula pedunculata" = "Lavandula","Lavandula stoechas" = "Lavandula"))

# hymenoptera visitation
ta_f4_la<-lavan_tog %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(glmer(cbind(fruit_formado, Fruit_No)~Hym_visit + (1|Site_ID),family=binomial,data)))%>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()


opts <- options(knitr.kable.NA = "")

ta_f4_la<-ta_f4_la %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
ta_f4_la<-filter(ta_f4_la, !term == "sd__(Intercept)")


ta_f4_la %>% 
    kable("latex",booktabs = TRUE,digits =  4, linesep = c("","\\addlinespace")) %>% 
column_spec(6, bold = ifelse(ta_f4_la$p.value < 0.05, T, F) )%>%
  kable_styling(position="center", latex_option="hold_position")

```



\newpage

## Fruit proportion - frequency

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%"}
Pollinator_Plant<- read.csv("../Data/Pollinator_Plant.csv") 
Pollinator_Plant<-Pollinator_Plant[,-1]

#Species out
spp_out <- Pollinator_Plant %>%
  group_by(Plant_gen_sp) %>%
  summarise(Unique_Id = n_distinct(Site_ID)) %>%
  filter(Unique_Id == 1) %>%
  select(Plant_gen_sp) %>% pull(Plant_gen_sp)


#Data with species in more than 1 site
Pollinator_Plant = Pollinator_Plant %>% filter(!Plant_gen_sp %in% spp_out)

# replace NAs by 0
Pollinator_Plant <- mutate_all(Pollinator_Plant, ~replace(., is.na(.), 0))

lavan_tog=Pollinator_Plant %>%
  mutate(Plant_gen_sp = recode(Plant_gen_sp, "Lavandula pedunculata" = "Lavandula","Lavandula stoechas" = "Lavandula"))

# frequency
ta_f3_la<-lavan_tog %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(glmer(cbind(fruit_formado, Fruit_No)~Frequency + (1|Site_ID),family=binomial,data)))%>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()

opts <- options(knitr.kable.NA = "")

ta_f3_la<-ta_f3_la %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
ta_f3_la<-filter(ta_f3_la, !term == "sd__(Intercept)")


ta_f3_la %>% 
    kable("latex",booktabs = TRUE,digits =  4, linesep = c("","\\addlinespace")) %>% 
column_spec(6, bold = ifelse(ta_f3_la$p.value < 0.05, T, F) )%>%
  kable_styling(position="center", latex_option="hold_position")

```

\newpage

## Seed number - richness

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%"}
Pollinator_Plant<- read.csv("../Data/Pollinator_Plant.csv") 
Pollinator_Plant<-Pollinator_Plant[,-1]

#Species out
spp_out <- Pollinator_Plant %>%
  group_by(Plant_gen_sp) %>%
  summarise(Unique_Id = n_distinct(Site_ID)) %>%
  filter(Unique_Id == 1) %>%
  select(Plant_gen_sp) %>% pull(Plant_gen_sp)


#Data with species in more than 1 site
Pollinator_Plant = Pollinator_Plant %>% filter(!Plant_gen_sp %in% spp_out)

# replace NAs by 0
Pollinator_Plant <- mutate_all(Pollinator_Plant, ~replace(., is.na(.), 0))

lavan_tog=Pollinator_Plant %>%
  mutate(Plant_gen_sp = recode(Plant_gen_sp, "Lavandula pedunculata" = "Lavandula","Lavandula stoechas" = "Lavandula"))

# richness
ta_seed_la<-lavan_tog %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seeds~richness+(1|Site_ID),data))) %>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()

opts <- options(knitr.kable.NA = "")

ta_seed_la<-ta_seed_la %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
ta_seed_la<-filter(ta_seed_la, !term == "sd__(Intercept)" & !term =="sd__Observation")


ta_seed_la %>% 
kable("latex", booktabs = TRUE,digits =  4, linesep = c("","\\addlinespace")) %>% 
column_spec(7, bold = ifelse(ta_seed_la$p.value < 0.05, T, F) )%>%
  kable_styling(position="center", latex_option="hold_position")

```

\newpage

## Seed number - visitation rate

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%"}
Pollinator_Plant<- read.csv("../Data/Pollinator_Plant.csv") 
Pollinator_Plant<-Pollinator_Plant[,-1]

#Species out
spp_out <- Pollinator_Plant %>%
  group_by(Plant_gen_sp) %>%
  summarise(Unique_Id = n_distinct(Site_ID)) %>%
  filter(Unique_Id == 1) %>%
  select(Plant_gen_sp) %>% pull(Plant_gen_sp)


#Data with species in more than 1 site
Pollinator_Plant = Pollinator_Plant %>% filter(!Plant_gen_sp %in% spp_out)

# replace NAs by 0
Pollinator_Plant <- mutate_all(Pollinator_Plant, ~replace(., is.na(.), 0))

lavan_tog=Pollinator_Plant %>%
  mutate(Plant_gen_sp = recode(Plant_gen_sp, "Lavandula pedunculata" = "Lavandula","Lavandula stoechas" = "Lavandula"))

# visistation rate
ta_seed2_la<-lavan_tog %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seeds~visitatio_rate+(1|Site_ID),data))) %>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()

opts <- options(knitr.kable.NA = "")

ta_seed2_la<-ta_seed2_la %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
ta_seed2_la<-filter(ta_seed2_la, !term == "sd__(Intercept)" & !term =="sd__Observation")


ta_seed2_la %>% 
kable("latex", booktabs = TRUE,digits =  4, linesep = c("","\\addlinespace")) %>% 
column_spec(7, bold = ifelse(ta_seed2_la$p.value < 0.05, T, F) )%>%
  kable_styling(position="center", latex_option="hold_position")

```

\newpage

## Seed number - hymenoptera visitation

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%"}
Pollinator_Plant<- read.csv("../Data/Pollinator_Plant.csv") 
Pollinator_Plant<-Pollinator_Plant[,-1]

#Species out
spp_out <- Pollinator_Plant %>%
  group_by(Plant_gen_sp) %>%
  summarise(Unique_Id = n_distinct(Site_ID)) %>%
  filter(Unique_Id == 1) %>%
  select(Plant_gen_sp) %>% pull(Plant_gen_sp)


#Data with species in more than 1 site
Pollinator_Plant = Pollinator_Plant %>% filter(!Plant_gen_sp %in% spp_out)

# replace NAs by 0
Pollinator_Plant <- mutate_all(Pollinator_Plant, ~replace(., is.na(.), 0))

lavan_tog=Pollinator_Plant %>%
  mutate(Plant_gen_sp = recode(Plant_gen_sp, "Lavandula pedunculata" = "Lavandula","Lavandula stoechas" = "Lavandula"))


# hymenoptera visitation
ta_seed4_la<-lavan_tog %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seeds~Hym_visit+(1|Site_ID),data))) %>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()

opts <- options(knitr.kable.NA = "")

ta_seed4_la<-ta_seed4_la %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
ta_seed4_la<-filter(ta_seed4_la, !term == "sd__(Intercept)" & !term =="sd__Observation")


ta_seed4_la %>% 
kable("latex", booktabs = TRUE,digits =  4, linesep = c("","\\addlinespace")) %>% 
column_spec(7, bold = ifelse(ta_seed4_la$p.value < 0.05, T, F) )%>%
  kable_styling(position="center", latex_option="hold_position")


```



\newpage

## Seed number - frequency

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%"}
Pollinator_Plant<- read.csv("../Data/Pollinator_Plant.csv") 
Pollinator_Plant<-Pollinator_Plant[,-1]

#Species out
spp_out <- Pollinator_Plant %>%
  group_by(Plant_gen_sp) %>%
  summarise(Unique_Id = n_distinct(Site_ID)) %>%
  filter(Unique_Id == 1) %>%
  select(Plant_gen_sp) %>% pull(Plant_gen_sp)


#Data with species in more than 1 site
Pollinator_Plant = Pollinator_Plant %>% filter(!Plant_gen_sp %in% spp_out)

# replace NAs by 0
Pollinator_Plant <- mutate_all(Pollinator_Plant, ~replace(., is.na(.), 0))

lavan_tog=Pollinator_Plant %>%
  mutate(Plant_gen_sp = recode(Plant_gen_sp, "Lavandula pedunculata" = "Lavandula","Lavandula stoechas" = "Lavandula"))


# Frequency
ta_seed3_la<-lavan_tog %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seeds~Frequency+(1|Site_ID),data))) %>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()

opts <- options(knitr.kable.NA = "")

ta_seed3_la<-ta_seed3_la %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
ta_seed3_la<-filter(ta_seed3_la, !term == "sd__(Intercept)" & !term =="sd__Observation")


ta_seed3_la %>% 
kable("latex", booktabs = TRUE,digits =  4, linesep = c("","\\addlinespace")) %>% 
column_spec(7, bold = ifelse(ta_seed3_la$p.value < 0.05, T, F) )%>%
  kable_styling(position="center", latex_option="hold_position")

```

\newpage

## Seed weight - richness

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%"}
Pollinator_Plant<- read.csv("../Data/Pollinator_Plant.csv") 
Pollinator_Plant<-Pollinator_Plant[,-1]

#Species out
spp_out <- Pollinator_Plant %>%
  group_by(Plant_gen_sp) %>%
  summarise(Unique_Id = n_distinct(Site_ID)) %>%
  filter(Unique_Id == 1) %>%
  select(Plant_gen_sp) %>% pull(Plant_gen_sp)


#Data with species in more than 1 site
Pollinator_Plant = Pollinator_Plant %>% filter(!Plant_gen_sp %in% spp_out)

# replace NAs by 0
Pollinator_Plant <- mutate_all(Pollinator_Plant, ~replace(., is.na(.), 0))

lavan_tog=Pollinator_Plant %>%
  mutate(Plant_gen_sp = recode(Plant_gen_sp, "Lavandula pedunculata" = "Lavandula","Lavandula stoechas" = "Lavandula"))

# richnes
ta_weight_la<-lavan_tog %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seed_weight~richness+(1|Site_ID),data))) %>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()

opts <- options(knitr.kable.NA = "")

ta_weight_la<-ta_weight_la %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
ta_weight_la<-filter(ta_weight_la, !term == "sd__(Intercept)" & !term =="sd__Observation")


ta_weight_la %>% 
kable("latex", booktabs = TRUE,digits =  4, linesep = c("","\\addlinespace")) %>% 
column_spec(7, bold = ifelse(ta_weight_la$p.value < 0.05, T, F) )%>%
  kable_styling(position="center", latex_option="hold_position")

```

\newpage

## Seed weight - visitation rate

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%"}
Pollinator_Plant<- read.csv("../Data/Pollinator_Plant.csv") 
Pollinator_Plant<-Pollinator_Plant[,-1]

#Species out
spp_out <- Pollinator_Plant %>%
  group_by(Plant_gen_sp) %>%
  summarise(Unique_Id = n_distinct(Site_ID)) %>%
  filter(Unique_Id == 1) %>%
  select(Plant_gen_sp) %>% pull(Plant_gen_sp)


#Data with species in more than 1 site
Pollinator_Plant = Pollinator_Plant %>% filter(!Plant_gen_sp %in% spp_out)

# replace NAs by 0
Pollinator_Plant <- mutate_all(Pollinator_Plant, ~replace(., is.na(.), 0))

lavan_tog=Pollinator_Plant %>%
  mutate(Plant_gen_sp = recode(Plant_gen_sp, "Lavandula pedunculata" = "Lavandula","Lavandula stoechas" = "Lavandula"))


# visistation rate
ta_weight2_la<-lavan_tog %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seed_weight~visitatio_rate+(1|Site_ID),data))) %>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()

opts <- options(knitr.kable.NA = "")

ta_weight2_la<-ta_weight2_la %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
ta_weight2_la<-filter(ta_weight2_la, !term == "sd__(Intercept)" & !term =="sd__Observation")


ta_weight2_la %>% 
kable("latex", booktabs = TRUE,digits =  4, linesep = c("","\\addlinespace")) %>% 
column_spec(7, bold = ifelse(ta_weight2_la$p.value < 0.05, T, F) )%>%
  kable_styling(position="center", latex_option="hold_position")

```

\newpage

## Seed weight - hymenoptera visitation

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%"}
Pollinator_Plant<- read.csv("../Data/Pollinator_Plant.csv") 
Pollinator_Plant<-Pollinator_Plant[,-1]

#Species out
spp_out <- Pollinator_Plant %>%
  group_by(Plant_gen_sp) %>%
  summarise(Unique_Id = n_distinct(Site_ID)) %>%
  filter(Unique_Id == 1) %>%
  select(Plant_gen_sp) %>% pull(Plant_gen_sp)


#Data with species in more than 1 site
Pollinator_Plant = Pollinator_Plant %>% filter(!Plant_gen_sp %in% spp_out)

# replace NAs by 0
Pollinator_Plant <- mutate_all(Pollinator_Plant, ~replace(., is.na(.), 0))

lavan_tog=Pollinator_Plant %>%
  mutate(Plant_gen_sp = recode(Plant_gen_sp, "Lavandula pedunculata" = "Lavandula","Lavandula stoechas" = "Lavandula"))


# hymenoptera visitation
ta_weight4_la<-lavan_tog %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seed_weight~Hym_visit+(1|Site_ID),data))) %>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()

opts <- options(knitr.kable.NA = "")

ta_weight4_la<-ta_weight4_la %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
ta_weight4_la<-filter(ta_weight4_la, !term == "sd__(Intercept)" & !term =="sd__Observation")


ta_weight4_la %>% 
kable("latex", booktabs = TRUE,digits =  4, linesep = c("","\\addlinespace")) %>% 
column_spec(7, bold = ifelse(ta_weight4_la$p.value < 0.05, T, F) )%>%
  kable_styling(position="center", latex_option="hold_position")

```



\newpage

## Seed weight - frequency

```{r, echo=FALSE, warning=FALSE,message=FALSE, out.width="100%"}
Pollinator_Plant<- read.csv("../Data/Pollinator_Plant.csv") 
Pollinator_Plant<-Pollinator_Plant[,-1]

#Species out
spp_out <- Pollinator_Plant %>%
  group_by(Plant_gen_sp) %>%
  summarise(Unique_Id = n_distinct(Site_ID)) %>%
  filter(Unique_Id == 1) %>%
  select(Plant_gen_sp) %>% pull(Plant_gen_sp)


#Data with species in more than 1 site
Pollinator_Plant = Pollinator_Plant %>% filter(!Plant_gen_sp %in% spp_out)

# replace NAs by 0
Pollinator_Plant <- mutate_all(Pollinator_Plant, ~replace(., is.na(.), 0))

lavan_tog=Pollinator_Plant %>%
  mutate(Plant_gen_sp = recode(Plant_gen_sp, "Lavandula pedunculata" = "Lavandula","Lavandula stoechas" = "Lavandula"))


# frequency
ta_weight3_la<-lavan_tog %>%
  nest_by(Plant_gen_sp) %>%
  mutate(model = list(lmer(Seed_weight~Frequency+(1|Site_ID),data))) %>%
  summarise(broom.mixed::tidy(model)) %>%
  ungroup()

opts <- options(knitr.kable.NA = "")

ta_weight3_la<-ta_weight3_la %>%
  select(-effect, -group)  %>%
  mutate(Plant_gen_sp = replace(Plant_gen_sp, duplicated(Plant_gen_sp), ""))
  
ta_weight3_la<-filter(ta_weight3_la, !term == "sd__(Intercept)" & !term =="sd__Observation")


ta_weight3_la %>% 
kable("latex", booktabs = TRUE,digits =  4, linesep = c("","\\addlinespace")) %>% 
column_spec(7, bold = ifelse(ta_weight3_la$p.value < 0.05, T, F) )%>%
  kable_styling(position="center", latex_option="hold_position")

```

